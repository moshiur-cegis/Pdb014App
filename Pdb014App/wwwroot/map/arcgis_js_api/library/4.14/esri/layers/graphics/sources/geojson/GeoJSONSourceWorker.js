// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(C,a,v,q,b,c,k,n){function u(a,l){return a?l?4:3:l?3:2}function y(a,l,e,g){if(a){if(e)return l&&g?aa:Z;if(l&&g)return W}else if(l&&g)return Z;return N}function E(a,l){return Math.round((l-a.translate[0])/a.scale[0])}function x(a,l){return Math.round((a.translate[1]-
l)/a.scale[1])}function F(a,l){return l*a.scale[0]+a.translate[0]}function D(a,l){return a.translate[1]-l*a.scale[1]}function H(a){a=a.coords;return{x:a[0],y:a[1]}}function G(a,l){a.coords[0]=l.x;a.coords[1]=l.y;return a}function A(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function h(a,l){a.coords[0]=l.x;a.coords[1]=l.y;a.coords[2]=l.z;return a}function r(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function e(a,l){a.coords[0]=l.x;a.coords[1]=l.y;a.coords[2]=l.m;return a}function g(a){a=a.coords;return{x:a[0],
y:a[1],z:a[2],m:a[3]}}function p(a,l){a.coords[0]=l.x;a.coords[1]=l.y;a.coords[2]=l.z;a.coords[3]=l.m;return a}function m(a,l){return a&&l?p:a?h:l?e:G}function t(a,l,e){if(!a)return null;for(var g=u(l,e),b=[],p=0;p<a.coords.length;p+=g){for(var c=[],h=0;h<g;h++)c.push(a.coords[p+h]);b.push(c)}return l?e?{points:b,hasZ:l,hasM:e}:{points:b,hasZ:l}:e?{points:b,hasM:e}:{points:b}}function U(a,l,e){void 0===e&&(e=u(l.hasZ,l.hasM));a.lengths[0]=l.points.length;var g=a.coords,b=0,p=0;for(l=l.points;p<l.length;p++)for(var h=
l[p],c=0;c<e;c++)g[b++]=h[c];return a}function ba(a,l,e){if(!a)return null;var g=u(l,e),b=a.coords,p=[],c=0,h=0;for(a=a.lengths;h<a.length;h++){for(var m=a[h],w=[],r=0;r<m;r++){for(var t=[],k=0;k<g;k++)t.push(b[c++]);w.push(t)}p.push(w)}return l?e?{paths:p,hasZ:l,hasM:e}:{paths:p,hasZ:l}:e?{paths:p,hasM:e}:{paths:p}}function ja(a,l,e){void 0===e&&(e=u(l.hasZ,l.hasM));var g=a.lengths,b=a.coords,p=0,h=0;for(l=l.paths;h<l.length;h++){for(var c=l[h],m=0,w=c;m<w.length;m++)for(var r=w[m],t=0;t<e;t++)b[p++]=
r[t];g.push(c.length)}return a}function X(a,l,e){if(!a)return null;var g=u(l,e),b=a.coords,p=[],h=0,c=0;for(a=a.lengths;c<a.length;c++){for(var m=a[c],w=[],r=0;r<m;r++){for(var t=[],k=0;k<g;k++)t.push(b[h++]);w.push(t)}p.push(w)}return l?e?{rings:p,hasZ:l,hasM:e}:{rings:p,hasZ:l}:e?{rings:p,hasM:e}:{rings:p}}function I(a,e,g,b){void 0===g&&(g=e.hasZ);void 0===b&&(b=e.hasM);l(a,e.rings,g,b);return a}function l(a,l,e,g){e=u(e,g);g=a.lengths;for(var b=a.coords,p=0,c=g.length=b.length=0;c<l.length;c++){for(var h=
l[c],m=0,w=h;m<w.length;m++)for(var r=w[m],t=0;t<e;t++)b[p++]=r[t];g.push(h.length)}return a}function w(a,l,e,g,b,p){a.length=0;if(!e){for(g=0;g<l.length;g++)b=l[g],a.push(new c.default(null,b.attributes,null,b.attributes[p]));return a}switch(e){case "esriGeometryPoint":g=m(g,b);for(b=0;b<l.length;b++){var h=l[b];e=h.geometry;var h=h.attributes,w=void 0;e&&(w=g(new n.default,e));a.push(new c.default(w,h,null,h[p]))}break;case "esriGeometryMultipoint":g=u(g,b);for(b=0;b<l.length;b++)h=l[b],e=h.geometry,
h=h.attributes,w=void 0,e&&(w=U(new n.default,e,g)),a.push(new c.default(w,h,null,h[p]));break;case "esriGeometryPolyline":g=u(g,b);for(b=0;b<l.length;b++)h=l[b],e=h.geometry,h=h.attributes,w=void 0,e&&(w=ja(new n.default,e,g)),a.push(new c.default(w,h,null,h[p]));break;case "esriGeometryPolygon":for(e=0;e<l.length;e++){var r=l[e],h=r.geometry,w=r.centroid,r=r.attributes,t=void 0;h&&(t=I(new n.default,h,g,b));w?a.push(new c.default(t,r,G(new n.default,w),r[p])):a.push(new c.default(t,r,null,r[p]))}break;
default:na.error("convertToFeatureSet:unknown-geometry",new v("Unable to parse unknown geometry type '"+e+"'")),a.length=0}return a}function L(a,l,e,b,h){a.length=0;switch(e){case "esriGeometryPoint":e=H;b&&h?e=g:b?e=A:h&&(e=r);for(b=0;b<l.length;b++){var p=l[b];h=p.geometry;p=p.attributes;h=h?e(h):null;a.push({attributes:p,geometry:h})}break;case "esriGeometryMultipoint":for(e=0;e<l.length;e++){var c=l[e],p=c.geometry,c=c.attributes,m=void 0;p&&(m=t(p,b,h));a.push({attributes:c,geometry:m})}break;
case "esriGeometryPolyline":for(e=0;e<l.length;e++)c=l[e],p=c.geometry,c=c.attributes,m=void 0,p&&(m=ba(p,b,h)),a.push({attributes:c,geometry:m});break;case "esriGeometryPolygon":for(e=0;e<l.length;e++){var m=l[e],c=m.geometry,p=m.attributes,w=m.centroid,m=void 0;c&&(m=X(c,b,h));w?(c=H(w),a.push({attributes:p,centroid:c,geometry:m})):a.push({attributes:p,geometry:m})}break;default:na.error("convertToFeatureSet:unknown-geometry",new v("Unable to parse unknown geometry type '"+e+"'"))}return a}function M(a,
l,e,b,g,h,p,c){void 0===p&&(p=e);void 0===c&&(c=b);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!l||!l.coords.length)return null;g=oa[g];var m=l.coords;l=l.lengths;var w=u(e,b),r=u(e&&p,b&&c);e=y(e,b,p,c);if(!l.length)return e(a.coords,m,0,0,E(h,m[0]),x(h,m[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=w,a;for(var t,k=0,n,A=0,D=0;D<l.length;D++){var R=l[D];if(!(R<g)){var I=0;n=A;c=b=E(h,m[k]);t=p=x(h,m[k+1]);e(a.coords,m,n,k,c,t);I++;k+=w;n+=r;for(var H=
1;H<R;H++,k+=w)if(c=E(h,m[k]),t=x(h,m[k+1]),c!==b||t!==p)e(a.coords,m,n,k,c-b,t-p),n+=r,I++,b=c,p=t;I>=g&&(a.lengths.push(I),A=n)}}a.coords.length=A;return a.coords.length?a:null}function R(a,l,e,b,g,h,p){for(var c=b,m=0,w,r=h+e;r<p;r+=e){w=l[r];var t=l[r+1],k=l[p],n=l[p+1],A=l[h],D=l[h+1],I=k-A,u=n-D;if(0!==I||0!==u){var H=((w-A)*I+(t-D)*u)/(I*I+u*u);1<H?(A=k,D=n):0<H&&(A+=I*H,D+=u*H)}I=w-A;u=t-D;w=I*I+u*u;w>c&&(m=r,c=w)}c>b&&(m-h>e&&R(a,l,e,b,g,h,m),g(a,l,a.length,m,l[m],l[m+1]),p-m>e&&R(a,l,e,
b,g,m,p))}function ca(a,l,e,b,g){var h=l.coords,p=l.lengths,c=e?b?aa:Z:b?Z:N;e=u(e,b);if(!h.length)return a!==l&&(a.lengths.length=0,a.coords.length=0),a;if(!p.length)return c(a.coords,h,0,0,F(g,h[0]),D(g,h[1])),a!==l&&(a.lengths.length=0,a.coords.length=e),a;var m=g.scale;b=m[0];for(var m=m[1],w=0,r=0;r<p.length;r++){var t=p[r];a.lengths[r]=t;var k=F(g,h[w]),n=D(g,h[w+1]);c(a.coords,h,w,w,k,n);for(var w=w+e,A=1;A<t;A++,w+=e)k+=h[w]*b,n-=h[w+1]*m,c(a.coords,h,w,w,k,n)}a!==l&&(a.lengths.length=p.length,
a.coords.length=h.length);return a}Object.defineProperty(a,"__esModule",{value:!0});var na=q.getLogger("esri.tasks.support.optimizedFeatureSet"),oa={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},N=function(a,l,e,b,g,h){a[e]=g;a[e+1]=h},Z=function(a,l,e,b,g,h){a[e]=g;a[e+1]=h;a[e+2]=l[b+2]},W=function(a,l,e,b,g,h){a[e]=g;a[e+1]=h;a[e+2]=l[b+3]},aa=function(a,l,e,b,g,h){a[e]=g;a[e+1]=h;a[e+2]=l[b+2];a[e+3]=l[b+3]};a.quantizeX=E;a.quantizeY=x;a.hydrateX=F;
a.hydrateY=D;a.convertToPoint=function(a,l,e){return a?l?e?g(a):A(a):e?r(a):H(a):null};a.convertFromPoint=function(a,l,e){void 0===e&&(e=m(null!=l.z,null!=l.m));return e(a,l)};a.convertToMultipoint=t;a.convertFromMultipoint=U;a.convertToPolyline=ba;a.convertFromPolyline=ja;a.convertToPolygon=X;a.convertFromPolygon=I;a.convertFromNestedArray=l;var Y=[],V=[];a.convertFromFeature=function(a,l,e,b,g){Y[0]=a;a=w(V,Y,l,e,b,g)[0];Y.length=V.length=0;return a};a.convertFromFeatures=w;a.convertToFeature=function(a,
l,e,b){V[0]=a;L(Y,V,l,e,b);a=Y[0];Y.length=V.length=0;return a};a.convertFromGeometry=function(a,l,e){if(!a)return null;var g=new n.default;"hasZ"in a&&null==l&&(l=a.hasZ);"hasM"in a&&null==e&&(e=a.hasM);if(b.isPoint(a))return m(null!=l?l:null!=a.z,null!=e?e:null!=a.m)(g,a);if(b.isPolygon(a))return I(g,a,l,e);if(b.isPolyline(a))return ja(g,a,u(l,e));if(b.isMultipoint(a))return U(g,a,u(l,e));na.error("convertFromGeometry:unknown-geometry",new v("Unable to parse unknown geometry type '"+a+"'"))};a.convertToGeometry=
function(a,l,e,b){a=a&&("coords"in a?a:a.geometry);if(!a)return null;switch(l){case "esriGeometryPoint":return l=H,e&&b?l=g:e?l=A:b&&(l=r),l(a);case "esriGeometryMultipoint":return t(a,e,b);case "esriGeometryPolyline":return ba(a,e,b);case "esriGeometryPolygon":return X(a,e,b);default:na.error("convertToGeometry:unknown-geometry",new v("Unable to parse unknown geometry type '"+l+"'"))}};a.convertToFeatures=L;a.convertToFeatureSet=function(a){var l=a.objectIdFieldName,e=a.spatialReference,b=a.transform,
g=a.fields,h=a.hasM,p=a.hasZ,c=a.geometryType,m=a.exceededTransferLimit;a={features:L([],a.features,c,p,h),fields:g,geometryType:c,objectIdFieldName:l,spatialReference:e};b&&(a.transform=b);m&&(a.exceededTransferLimit=m);h&&(a.hasM=h);p&&(a.hasZ=p);return a};a.convertFromFeatureSet=function(a,l){var e=new k.default,b=a.hasM,g=a.hasZ,h=a.features,p=a.objectIdFieldName,c=a.spatialReference,m=a.geometryType,r=a.exceededTransferLimit,t=a.transform;e.fields=a.fields;e.geometryType=m;e.objectIdFieldName=
p||l;e.spatialReference=c;if(!e.objectIdFieldName)return na.error(new v("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),e;h&&w(e.features,h,m,g,b,e.objectIdFieldName);r&&(e.exceededTransferLimit=r);b&&(e.hasM=b);g&&(e.hasZ=g);t&&(e.transform=t);return e};a.hydrateOptimizedFeatureSet=function(a){var l=a.transform,e=a.hasM,b=a.hasZ;if(!l)return a;for(var g=0,h=a.features;g<h.length;g++){var p=h[g];p.geometry&&ca(p.geometry,p.geometry,e,b,l);p.centroid&&ca(p.centroid,
p.centroid,e,b,l)}a.transform=null;return a};a.quantizeOptimizedFeatureSet=function(a,l){var e=l.geometryType,b=l.features,g=l.hasM,h=l.hasZ;if(!a)return l;for(var p=0;p<b.length;p++){var m=b[p],w=new c.default(new n.default,m.attributes);M(w.geometry,m.geometry,g,h,e,a);m.centroid&&(w.centroid=new n.default,M(w.centroid,m.centroid,g,h,"esriGeometryPoint",a));b[p]=w}l.transform=a;return l};a.quantizeOptimizedGeometry=M;a.generalizeOptimizedGeometry=function(a,l,e,b,g,h,p,c){void 0===p&&(p=e);void 0===
c&&(c=b);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!l||!l.coords.length)return null;g=oa[g];var m=l.coords;l=l.lengths;var w=u(e,b),r=u(e&&p,b&&c);e=y(e,b,p,c);if(!l.length)return e(a.coords,m,0,0,m[0],m[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=w,a;b=0;h*=h;for(p=0;p<l.length;p++){c=l[p];if(!(c<g)){var t=a.coords.length/r,k=b,n=b+(c-1)*w;e(a.coords,m,a.coords.length,k,m[k],m[k+1]);R(a.coords,m,w,h,e,k,n);e(a.coords,m,a.coords.length,n,m[n],m[n+
1]);k=a.coords.length/r-t;k>=g?a.lengths.push(k):a.coords.length=t*r}b+=c*w}return a.coords.length?a:null};a.getBoundsOptimizedGeometry=function(a,l,e,b){e=u(e,b);var g=b=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;if(l&&l.coords){l=l.coords;for(var c=0;c<l.length;c+=e){var m=l[c],w=l[c+1];b=Math.min(b,m);h=Math.max(h,m);g=Math.min(g,w);p=Math.max(p,w)}}a[0]=b;a[1]=g;a[2]=h;a[3]=p;return a};a.getQuantizedBoundsOptimizedGeometry=function(a,l,e,b){e=u(e,b);b=l.coords;
var g=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,m=0,w=0;for(l=l.lengths;w<l.length;w++)for(var r=l[w],t=b[m],k=b[m+1],g=Math.min(t,g),h=Math.min(k,h),p=Math.max(t,p),c=Math.max(k,c),m=m+e,n=1;n<r;n++,m+=e){var A=b[m],D=b[m+1],t=t+A,k=k+D;0>A&&(g=Math.min(g,t));0<A&&(p=Math.max(p,t));0>D?h=Math.min(h,k):0<D&&(c=Math.max(c,k))}a[0]=g;a[1]=h;a[2]=p;a[3]=c;return a};a.hydrateOptimizedGeometry=ca;a.removeZMValues=function(a,l,e,b,g,h){var p,
c=u(e,b);e=y(e,b,g,h);b=l.coords;a.coords.length=0;a.lengths.length=0;(p=a.lengths).push.apply(p,l.lengths);for(l=0;l<b.length;l+=c)e(a.coords,b,a.coords.length,l,b[l],b[l+1]);return a};a.removeCollinearVectices=function(a,l,e,b,g){if(!l||!l.coords||!l.coords.length)return null;e=oa[e];var h=l.coords;l=l.lengths;var p=y(b,g,b,g);b=u(b,g);for(var c=g=0,m=0,w=0,r=0;r<l.length;r++){var t=l[r],c=w;p(a.coords,h,c,g,h[g],h[g+1]);g+=b;var k=h[g],n=h[g+1],A=k,D=n,I=n/k,c=c+b;p(a.coords,h,c,g,A,D);g+=b;for(var R=
2;R<t;R++){var k=h[g],n=h[g+1],H=n/k,L=I===H||!isFinite(I)&&!isFinite(H),I=L&&isFinite(H)?0<=I&&0<=H||0>=I&&0>=H:0<=D&&0<=n||0>=D&&0>=n;L&&I?(A+=k,D+=n):(A=k,D=n,c+=b);p(a.coords,h,c,g,A,D);g+=b;I=H}c+=b;t=(c-w)/b;t>=e&&(a.lengths[m]=t,w=c,m++)}a.coords.length>c&&(a.coords.length=c);a.lengths.length>m&&(a.lengths.length=m);return a.coords.length?a:null}})},"esri/layers/graphics/data/FeatureStore":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./BoundsStore ./executeTileQuery ./optimizedFeatureQueryEngineAdapter".split(" "),
function(C,a,v,q,b,c,k,n,u,y,E,x,F,D,H,G,A){Object.defineProperty(a,"__esModule",{value:!0});var h=u.getLogger("esri.layers.graphics.data.FeatureStore");C=function(){function a(a){this.geometryInfo=a;this._boundsStore=new H.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new n;this.featureAdapter=A.optimizedFeatureQueryEngineAdapter}Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullBounds",{get:function(){var a=this;if(!this.numFeatures)return null;var b=x.create(x.NEGATIVE_INFINITY);this._featuresById.forEach(function(e){if(e=
a._boundsStore.get(e.objectId))b[0]=Math.min(e[0],b[0]),b[1]=Math.min(e[1],b[1]),b[2]=Math.max(e[2],b[2]),b[3]=Math.max(e[3],b[3])});return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"storeStatistics",{get:function(){var a=0;this._featuresById.forEach(function(e){e.geometry&&e.geometry.coords&&(a+=e.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:a/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0});a.prototype.add=
function(a){this._add(a);this._emitChanged()};a.prototype.addMany=function(a){for(var e=0;e<a.length;e++)this._add(a[e]);this._emitChanged()};a.prototype.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};a.prototype.removeById=function(a){a=this._featuresById.get(a);if(!a)return null;this._remove(a);this._emitChanged();return a};a.prototype.removeManyById=function(a){this._boundsStore.invalidateIndex();for(var e=0;e<a.length;e++){var b=this._featuresById.get(a[e]);
b&&this._remove(b)}this._emitChanged()};a.prototype.forEachBounds=function(a,b,h){for(var e=0;e<a.length;e++){var g=this._boundsStore.get(a[e].objectId);g&&b(E.fromRect(h,g))}};a.prototype.getFeature=function(a){return this._featuresById.get(a)};a.prototype.has=function(a){return this._featuresById.has(a)};a.prototype.forEach=function(a){this._featuresById.forEach(function(e){return a(e)})};a.prototype.forEachInBounds=function(a,b){var e=this;this._boundsStore.forEachInBounds(a,function(a){b(e._featuresById.get(a))})};
a.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};a.prototype.sweep=function(){var a=this,b=!1;this._featuresById.forEach(function(e,h){a._markedIds.has(h)||(b=!0,a._remove(e))});this._markedIds.clear();b&&this._emitChanged()};a.prototype.executeTileQuery=function(a,b,h){return q(this,void 0,void 0,function(){var e,g,c,p,r,k,n,l,w,A,D,u,H,q;return v(this,function(m){e=h.returnGeometry;g=h.returnCentroid;c=h.returnOutline;p=h.pixelBuffer;r=
new Set;k=[];n=p*a.resolution;l=x.pad(a.bounds,n,x.create());G.createTileFeatures(k,r,this.geometryInfo,this,l,e,g,c,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});if("esriGeometryPoint"===this.geometryType||g)if(w=F.getInfo(b))A=w.valid,D=A[0],u=A[1],l[0]<D&&(H=x.fromValues(u-n,l[1],u,l[3]),G.createTileFeatures(k,r,this.geometryInfo,this,H,e,g,c,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[u,a.bounds[3]]})),l[2]>u&&
(q=x.fromValues(D,l[1],D+n,l[3]),G.createTileFeatures(k,r,this.geometryInfo,this,q,e,g,c,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[D-u+a.bounds[0],a.bounds[3]]}));k.sort(function(a,l){return a.localId-l.localId});return[2,{features:k,objectIds:r}]})})};a.prototype._emitChanged=function(){this.events.emit("changed",void 0)};a.prototype._add=function(a){if(a){var e=a.objectId;if(null==e)h.error(new k("featurestore:invalid-feature","feature id is missing",{feature:a}));
else{var b=this._featuresById.get(e),c;this._markedIds.add(e);if(b)a.localId=b.localId,c=this._boundsStore.get(e),this._boundsStore.delete(e);else if(y.isSome(this.onFeatureAdd))this.onFeatureAdd(a);a.geometry&&a.geometry.coords&&a.geometry.coords.length?(c=D.getBoundsOptimizedGeometry(c||x.create(),a.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(e,c)):this._boundsStore.set(e,null);this._featuresById.set(e,a)}}};a.prototype._remove=function(a){if(y.isSome(this.onFeatureRemove))this.onFeatureRemove(a);
this._markedIds.delete(a.objectId);this._boundsStore.delete(a.objectId);this._featuresById.delete(a.objectId);return a};return a}();a.default=C})},"esri/layers/graphics/data/BoundsStore":function(){define(["require","exports","../../../core/has","../../../core/libs/rbush/rbush","@dojo/framework/shim/Promise"],function(C,a,v,q){Object.defineProperty(a,"__esModule",{value:!0});var b={minX:0,minY:0,maxX:0,maxY:0};C=function(){function a(){var a=this;this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=
new Map;this._idByBounds=new Map;this._index=q(9,v("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this._loadIndex=function(){if(a._indexInvalid){var b=Array(a._idByBounds.size),c=0;a._idByBounds.forEach(function(a,k){b[c++]=k});a._indexInvalid=!1;a._index.clear();a._index.load(b)}else a._boundsToLoad.length&&(a._index.load(a._boundsToLoad.filter(function(b){return a._idByBounds.has(b)})),a._boundsToLoad.length=0)}}a.prototype.clear=function(){this._indexInvalid=
!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};a.prototype.delete=function(a){var b=this._boundsById.get(a);this._boundsById.delete(a);b&&(this._idByBounds.delete(b),this._indexInvalid||this._index.remove(b))};a.prototype.forEachInBounds=function(a,c){this._loadIndex();var k=0,n=this._index;b.minX=a[0];b.minY=a[1];b.maxX=a[2];b.maxY=a[3];for(a=n.search(b);k<a.length;k++)c(this._idByBounds.get(a[k]))};a.prototype.get=function(a){return this._boundsById.get(a)};
a.prototype.has=function(a){return this._boundsById.has(a)};a.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};a.prototype.set=function(a,b){if(!this._indexInvalid){var c=this._boundsById.get(a);c&&(this._index.remove(c),this._idByBounds.delete(c))}this._boundsById.set(a,b);b&&(this._idByBounds.set(b,a),this._indexInvalid||this._boundsToLoad.push(b))};return a}();a.BoundsStore=C})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],
function(C){function a(b,c){if(!(this instanceof a))return new a(b,c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));this.clear()}function v(a,b){q(a,0,a.children.length,b,a)}function q(a,c,k,n,h){h||(h=x(null));h.minX=Infinity;h.minY=Infinity;h.maxX=-Infinity;h.maxY=-Infinity;for(var r;c<k;c++)r=a.children[c],b(h,a.leaf?n(r):r);return h}function b(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=
Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-b.minX}function k(a,b){return a.minY-b.minY}function n(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function u(a){return a.maxX-a.minX+(a.maxY-a.minY)}function y(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function E(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function x(a){return{children:a,height:1,leaf:!0,minX:Infinity,
minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function F(a,b,c,k,h){for(var r=[b,c],e;r.length;)c=r.pop(),b=r.pop(),c-b<=k||(e=b+Math.ceil((c-b)/k/2)*k,C(a,e,b,c,h),r.push(b,e,e,c))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],k=this.toBBox;if(!E(a,b))return c;for(var h=[],r,e,g,p;b;){r=0;for(e=b.children.length;r<e;r++)g=b.children[r],p=b.leaf?k(g):g,E(a,p)&&(b.leaf?c.push(g):y(a,p)?this._all(g,c):h.push(g));b=h.pop()}return c},collides:function(a){var b=
this.data,c=this.toBBox;if(!E(a,b))return!1;for(var k=[],h,r,e,g;b;){h=0;for(r=b.children.length;h<r;h++)if(e=b.children[h],g=b.leaf?c(e):e,E(a,g)){if(b.leaf||y(a,g))return!0;k.push(e)}b=k.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,
this.data=a,a=b),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=x([]);return this},remove:function(a,b){if(!a)return this;for(var c=this.data,k=this.toBBox(a),h=[],r=[],e,g,p,m;c||h.length;){c||(c=h.pop(),g=h[h.length-1],e=r.pop(),m=!0);if(c.leaf){a:{p=a;var t=c.children,n=b;if(n){for(var u=0;u<t.length;u++)if(n(p,t[u])){p=u;break a}p=-1}else p=t.indexOf(p)}if(-1!==p){c.children.splice(p,
1);h.push(c);this._condense(h);break}}m||c.leaf||!y(c,k)?g?(e++,c=g.children[e],m=!1):c=null:(h.push(c),r.push(e),e=0,g=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:c,compareMinY:k,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,k){var h=c-b+1,r=this._maxEntries,e;if(h<=r)return e=x(a.slice(b,c+1)),v(e,
this.toBBox),e;k||(k=Math.ceil(Math.log(h)/Math.log(r)),r=Math.ceil(h/Math.pow(r,k-1)));e=x([]);e.leaf=!1;e.height=k;var h=Math.ceil(h/r),r=h*Math.ceil(Math.sqrt(r)),g,p,m;for(F(a,b,c,r,this.compareMinX);b<=c;b+=r)for(p=Math.min(b+r-1,c),F(a,b,p,h,this.compareMinY),g=b;g<=p;g+=h)m=Math.min(g+h-1,p),e.children.push(this._build(a,g,m,k-1));v(e,this.toBBox);return e},_chooseSubtree:function(a,b,c,k){for(var h,r,e,g,p,m,t,A;;){k.push(b);if(b.leaf||k.length-1===c)break;t=A=Infinity;h=0;for(r=b.children.length;h<
r;h++)e=b.children[h],p=n(e),m=(Math.max(e.maxX,a.maxX)-Math.min(e.minX,a.minX))*(Math.max(e.maxY,a.maxY)-Math.min(e.minY,a.minY))-p,m<A?(A=m,t=p<t?p:t,g=e):m===A&&p<t&&(t=p,g=e);b=g||b.children[0]}return b},_insert:function(a,c,k){var n=this.toBBox;k=k?a:n(a);var n=[],h=this._chooseSubtree(k,this.data,c,n);h.children.push(a);for(b(h,k);0<=c;)if(n[c].children.length>this._maxEntries)this._split(n,c),c--;else break;this._adjustParentBBoxes(k,n,c)},_split:function(a,b){var c=a[b],k=c.children.length,
h=this._minEntries;this._chooseSplitAxis(c,h,k);k=this._chooseSplitIndex(c,h,k);k=x(c.children.splice(k,c.children.length-k));k.height=c.height;k.leaf=c.leaf;v(c,this.toBBox);v(k,this.toBBox);b?a[b-1].children.push(k):this._splitRoot(c,k)},_splitRoot:function(a,b){this.data=x([a,b]);this.data.height=a.height+1;this.data.leaf=!1;v(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var k,h,r,e,g,p,m;g=p=Infinity;for(k=b;k<=c-b;k++)h=q(a,0,k,this.toBBox),r=q(a,k,c,this.toBBox),e=Math.max(0,Math.min(h.maxX,
r.maxX)-Math.max(h.minX,r.minX))*Math.max(0,Math.min(h.maxY,r.maxY)-Math.max(h.minY,r.minY)),h=n(h)+n(r),e<g?(g=e,m=k,p=h<p?h:p):e===g&&h<p&&(p=h,m=k);return m},_chooseSplitAxis:function(a,b,n){var A=a.leaf?this.compareMinX:c,h=a.leaf?this.compareMinY:k,r=this._allDistMargin(a,b,n,A);b=this._allDistMargin(a,b,n,h);r<b&&a.children.sort(A)},_allDistMargin:function(a,c,k,n){a.children.sort(n);n=this.toBBox;var h=q(a,0,c,n),r=q(a,k-c,k,n),e=u(h)+u(r),g,p;for(g=c;g<k-c;g++)p=a.children[g],b(h,a.leaf?n(p):
p),e+=u(h);for(g=k-c-1;g>=c;g--)p=a.children[g],b(r,a.leaf?n(p):p),e+=u(r);return e},_adjustParentBBoxes:function(a,c,k){for(;0<=k;k--)b(c[k],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():v(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+
a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function C(q,b,c,k,n){for(;k>c;){if(600<k-c){var u=k-c+1,y=b-c+1,E=Math.log(u),x=.5*Math.exp(2*E/3),E=.5*Math.sqrt(E*x*(u-x)/u)*(0>y-u/2?-1:1);C(q,b,Math.max(c,Math.floor(b-y*x/u+E)),Math.min(k,Math.floor(b+(u-y)*x/u+E)),n)}u=q[b];y=c;x=k;a(q,c,b);for(0<n(q[k],u)&&a(q,c,k);y<x;){a(q,y,x);y++;for(x--;0>n(q[y],u);)y++;for(;0<n(q[x],u);)x--}0===n(q[c],u)?
a(q,c,x):(x++,a(q,x,k));x<=b&&(c=x+1);b<=x&&(k=x-1)}}function a(a,b,c){var k=a[b];a[b]=a[c];a[c]=k}function v(a,b){return a<b?-1:a>b?1:0}return function(a,b,c,k,n){C(a,b,c||0,k||a.length-1,n||v)}})},"esri/layers/graphics/data/executeTileQuery":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry/support/aaBoundingRect ../featureConversionUtils ../OptimizedGeometry ./QueryEngine ./utils".split(" "),
function(C,a,v,q,b,c,k,n,u,y){function E(a,b,c,h,r,e){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;var g=b.coords;b=b.lengths;if(!b.length)return a.coords[0]=k.quantizeX(e,g[0]),a.coords[1]=k.quantizeY(e,g[1]),a.coords.length=c,a;for(var p,m,t,n,A=0,u,q=0,I=0;I<b.length;I++){var l=b[I];if(!(l<h)){u=q;t=p=k.quantizeX(e,g[A]);n=m=k.quantizeY(e,g[A+1]);a.coords[u]=t;a.coords[u+1]=n;A+=c;t=k.quantizeX(e,g[A]);n=k.quantizeY(e,g[A+1]);var w=
t-p,L=n-m,y=L/w;u+=2;a.coords[u]=w;a.coords[u+1]=L;p=t;m=n;for(var A=A+c,R=2;R<l;R++){t=k.quantizeX(e,g[A]);n=k.quantizeY(e,g[A+1]);if(t!==p||n!==m){p=t-p;m=n-m;var x=m/p,y=y===x||!isFinite(y)&&!isFinite(x),F=(0<=L&&0<=m||0>=L&&0>=m)&&(0<=w&&0<=p||0>=w&&0>=p);y&&(r||F)?(w+=p,L+=m):(w=p,L=m,u+=2);a.coords[u]=w;a.coords[u+1]=L;y=x;p=t;m=n}A+=c}t=(u+2-q)/2;t>=h&&(a.lengths.push(t),q=u+2)}}a.coords.length>q&&(a.coords.length=q);return a.coords.length?a:null}Object.defineProperty(a,"__esModule",{value:!0});
var x=new n.default,F={esriGeometryPoint:k.convertToPoint,esriGeometryPolyline:k.convertToPolyline,esriGeometryPolygon:k.convertToPolygon,esriGeometryMultipoint:k.convertToMultipoint};a.executeTileQueryForIds=function(a,b,k){b=c.pad(b.bounds,k.pixelBuffer*b.resolution,c.create());var h=[];a.featureStore.forEachInBounds(b,function(b){return h.push(a.featureAdapter.getObjectId(b))});return h};a.createTileFeatures=function(a,b,c,h,k,e,g,p,m){var r=F[c.geometryType],n=D[c.geometryType],A="esriGeometryPolygon"===
c.geometryType&&!p,q=c.hasZ?c.hasM?4:3:c.hasM?3:2;g&&!e?h.forEachInBounds(k,function(e){if(!b.has(e.objectId)){var h=y.getCentroid(c,e,m),l=e.attributes;h&&(b.add(e.objectId),a.push(new u.Feature(l,e.localId,null,h)))}}):e&&!g?h.forEachInBounds(k,function(c){if(!b.has(c.objectId)){var e=c.attributes,l=r(E(x,c.geometry,q,n,A,m),!1,!1);l&&(b.add(c.objectId),a.push(new u.Feature(e,c.localId,l,null)))}}):h.forEachInBounds(k,function(e){if(!b.has(e.objectId)){var h=y.getCentroid(c,e,m),l=e.attributes,
g=r(E(x,e.geometry,q,n,A,m),!1,!1);g&&h&&(b.add(e.objectId),a.push(new u.Feature(l,e.localId,g,h)))}})};var D={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};a.quantizeOptimizedGeometryForDisplay=E})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(C,a,v,q,b,c,k,n,u,y,E,x,F,D,H,G,A,h,r,e,g,p,m,t,U,ba){Object.defineProperty(a,"__esModule",{value:!0});var ja=u.getLogger("esri.layers.graphics.data.QueryEngine");C=function(){return function(a,b,l,e,c){void 0===b&&(b=null);this.attributes=a;this.geometry=l;this.centroid=e;this.filterFlags=c;this.groupId=-1;this.localId=b}}();a.Feature=C;var X=new Set,I=new y.MemCacheStorage(2E6),l=0;C=function(){function a(a){var b=this;this.capabilities={query:e.queryCapabilities};this.geometryType=a.geometryType;
this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.cacheSpatialQueries=a.cacheSpatialQueries||!1;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new y.MemCache(l++ +"$$",I));this.fieldsIndex=new U(a.fields);a.scheduler&&a.task&&(this._frameQueue=
new ba.PromiseQueue,this._frameTask=a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}a.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};Object.defineProperty(a.prototype,
"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:t.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=m.getTimeExtent(this.timeInfo,
this.featureStore):null},enumerable:!0,configurable:!0});a.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};a.prototype.executeQuery=function(a,l){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,l,e;return q(this,function(c){switch(c.label){case 0:b=n.clone(a),c.label=1;case 1:return c.trys.push([1,14,,15]),[4,this._schedule()];case 2:return c.sent(),[4,t.normalizeQuery(b,this.definitionExpression,this.spatialReference)];
case 3:return b=c.sent(),[4,this._reschedule()];case 4:return c.sent(),[4,this._checkQuerySupport(b)];case 5:return b=c.sent(),[4,this._reschedule()];case 6:return c.sent(),[4,this._executeGeometryQuery(b)];case 7:return l=c.sent(),[4,this._reschedule()];case 8:return c.sent(),[4,l.executeObjectIdsQuery(b)];case 9:return l=c.sent(),[4,this._reschedule()];case 10:return c.sent(),[4,l.executeTimeQuery(b)];case 11:return l=c.sent(),[4,this._reschedule()];case 12:return c.sent(),[4,l.executeAttributesQuery(b)];
case 13:return l=c.sent(),[3,15];case 14:e=c.sent();if(e!==t.QUERY_ENGINE_EMPTY_RESULT)throw e;l=new g.default([],null,this);return[3,15];case 15:return[2,l.createQueryResponse(b)]}})})};a.prototype.executeQueryForCount=function(a,l){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,l,c;return q(this,function(e){switch(e.label){case 0:b=n.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,e.label=1;case 1:return e.trys.push([1,14,,15]),[4,this._schedule()];case 2:return e.sent(),
[4,t.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=e.sent(),[4,this._reschedule()];case 4:return e.sent(),[4,this._checkQuerySupport(b)];case 5:return b=e.sent(),[4,this._reschedule()];case 6:return e.sent(),[4,this._executeGeometryQuery(b)];case 7:return l=e.sent(),[4,this._reschedule()];case 8:return e.sent(),[4,l.executeObjectIdsQuery(b)];case 9:return l=e.sent(),[4,this._reschedule()];case 10:return e.sent(),[4,l.executeTimeQuery(b)];case 11:return l=e.sent(),
[4,this._reschedule()];case 12:return e.sent(),[4,l.executeAttributesQuery(b)];case 13:return l=e.sent(),[2,l.size];case 14:c=e.sent();if(c!==t.QUERY_ENGINE_EMPTY_RESULT)throw c;return[2,0];case 15:return[2]}})})};a.prototype.executeQueryForExtent=function(a,l){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,l,e,c,h,g,p,m;return q(this,function(k){switch(k.label){case 0:b=n.clone(a),e=b.outSR,k.label=1;case 1:return k.trys.push([1,14,,15]),[4,this._schedule()];case 2:return k.sent(),
[4,t.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=k.sent(),[4,this._reschedule()];case 4:return k.sent(),[4,this._checkQuerySupport(b)];case 5:return b=k.sent(),b.returnGeometry=!0,b.returnCentroid=!1,b.outSR=null,[4,this._reschedule()];case 6:return k.sent(),[4,this._executeGeometryQuery(b)];case 7:return l=k.sent(),[4,this._reschedule()];case 8:return k.sent(),[4,l.executeObjectIdsQuery(b)];case 9:return l=k.sent(),[4,this._reschedule()];case 10:return k.sent(),
[4,l.executeTimeQuery(b)];case 11:return l=k.sent(),[4,this._reschedule()];case 12:return k.sent(),[4,l.executeAttributesQuery(b)];case 13:l=k.sent();c=l.size;if(!c)return[2,{count:c,extent:null}];F.set(L,F.NEGATIVE_INFINITY);this.featureStore.forEachBounds(l.items,function(a){return F.expand(L,a)},w);h={xmin:L[0],ymin:L[1],xmax:L[3],ymax:L[4],spatialReference:t.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(L[2])&&isFinite(L[5])&&(h.zmin=L[2],h.zmax=L[5]);g=r.project(h,l.spatialReference,
e);g.spatialReference=t.cleanFromGeometryEngine(e||this.spatialReference);0===g.xmax-g.xmin&&(p=x.getMetersPerUnitForSR(g.spatialReference),g.xmin-=p,g.xmax+=p);0===g.ymax-g.ymin&&(p=x.getMetersPerUnitForSR(g.spatialReference),g.ymin-=p,g.ymax+=p);this.hasZ&&null!=g.zmin&&null!=g.zmax&&0===g.zmax-g.zmin&&(p=x.getMetersPerUnitForSR(g.spatialReference),g.zmin-=p,g.zmax+=p);return[2,{count:c,extent:g}];case 14:m=k.sent();if(m===t.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw m;case 15:return[2]}})})};
a.prototype.executeQueryForIds=function(a,l){void 0===a&&(a={});return b(this,void 0,void 0,function(){return q(this,function(b){return[2,this.executeQueryForIdSet(a,l).then(function(a){return k.valuesOfSet(a)})]})})};a.prototype.executeQueryForIdSet=function(a,l){void 0===a&&(a={});return b(this,void 0,void 0,function(){var b,l,e,c,h,g,p,m;return q(this,function(k){switch(k.label){case 0:b=n.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,k.label=1;case 1:return k.trys.push([1,13,,
14]),[4,this._schedule()];case 2:return k.sent(),[4,t.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=k.sent(),[4,this._reschedule()];case 4:return k.sent(),[4,this._executeGeometryQuery(b)];case 5:return l=k.sent(),[4,this._reschedule()];case 6:return k.sent(),[4,l.executeObjectIdsQuery(b)];case 7:return l=k.sent(),[4,this._reschedule()];case 8:return k.sent(),[4,l.executeTimeQuery(b)];case 9:return l=k.sent(),[4,this._reschedule()];case 10:return k.sent(),[4,l.executeAttributesQuery(b)];
case 11:return l=k.sent(),[4,this._reschedule()];case 12:k.sent();e=l.items;c=new Set;h=0;for(g=e;h<g.length;h++)p=g[h],c.add(l.featureAdapter.getObjectId(p));return[2,c];case 13:m=k.sent();if(m===t.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw m;case 14:return[2]}})})};a.prototype.executeQueryForLatestObservations=function(a,b){var l=this;if(this.timeInfo)return this.executeQuery(a,b).then(function(a){return l._filterLatest(a,l.timeInfo)});ja.error(new c("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};
a.prototype._schedule=function(a){return b(this,void 0,void 0,function(){return q(this,function(b){return this._frameQueue?[2,this._frameQueue.push(a).then(function(a){return a})]:[2,a]})})};a.prototype._reschedule=function(a){return b(this,void 0,void 0,function(){return q(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a).then(function(a){return a})]:[2,a]})})};a.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();
this._budget=null};a.prototype._filterLatest=function(a,b){var l=b.trackIdField,e=b.startTimeField;b=b.endTimeField||e;for(var e=new Map,c=[],h=0,g=a.features;h<g.length;h++){var p=g[h],m=p.attributes[l],k=p.attributes[b];(!e.has(m)||e.get(m).attributes[b]<k)&&e.set(m,p)}e.forEach(function(a){return c.push(a)});return v({},a,{features:c})};a.prototype._getAll=function(){if(!this._allItems){var a=[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new g.default(a,null,this)}return this._allItems};
a.prototype._executeGeometryQuery=function(a){return b(this,void 0,void 0,function(){var l,e,c,h,m,k,w,r,n,t,u,I,L,U,y,x,R,F,M,D,X,ba,E,v,ja=this;return q(this,function(ca){switch(ca.label){case 0:l=a.geometry;e=a.outSR;c=a.spatialRel;h=A.isValid(e)&&!A.equals(this.spatialReference,e);if(m=this.cacheSpatialQueries?h?JSON.stringify({geometry:l,spatialRelationship:c,outSpatialReference:e}):JSON.stringify({geometry:l,spatialRelationship:c}):null)if(k=this._geometryQueryCache.get(m),void 0!==k)return[2,
k];w=function(l){return b(ja,void 0,void 0,function(){var b;return q(this,function(c){switch(c.label){case 0:return h&&(a.returnGeometry||a.returnCentroid)?[4,l.project(e)]:[3,2];case 1:return b=c.sent(),m&&this._geometryQueryCache.put(m,b,b.size||1),[2,b];case 2:return m&&this._geometryQueryCache.put(m,l,l.size||1),[2,l]}})})};if(!l)return[2,w(this._getAll())];r=this.featureAdapter;if("esriSpatialRelDisjoint"!==c)return[3,5];n=this._searchFeatures(this._getQueryBBoxes(l));if(!n.length)return[2,w(this._getAll())];
I=new Set;L=0;for(U=n;L<U.length;L++)y=U[L],I.add(r.getObjectId(y));return[4,this._reschedule(I)];case 1:return I=ca.sent(),x=0,t=Array(I.size),this.featureStore.forEach(function(a){return t[x++]=a}),u=I,[4,this._reschedule()];case 2:return ca.sent(),[4,p.getSpatialQueryOperator(c,l,this)];case 3:return R=ca.sent(),F=function(a){return!u.has(r.getObjectId(a))||R(r.getGeometry(a))},D=g.default.bind,[4,this._runSpatialFilter(t,F)];case 4:return M=new (D.apply(g.default,[void 0,ca.sent(),l,this])),[2,
w(M)];case 5:return X=this._searchFeatures(this._getQueryBBoxes(l)),X.length?(ba=this._canExecuteSoloPass(l,a))?[2,w(new g.default(X,l,this))]:[4,p.getSpatialQueryOperator(c,l,this)]:(M=new g.default([],l,this),m&&this._geometryQueryCache.put(m,M,M.size||1),[2,M]);case 6:return E=ca.sent(),[4,this._runSpatialFilter(X,function(a){return E(r.getGeometry(a))})];case 7:return v=ca.sent(),[2,w(new g.default(v,l,this))]}})})};a.prototype._runSpatialFilter=function(a,l){return b(this,void 0,void 0,function(){var e,
c,h,g=this;return q(this,function(p){if(!l)return[2,a];if(!this._budget)return[2,a.filter(function(a){return l(a)})];e=0;c=[];h=function(){return b(g,void 0,void 0,function(){var b;return q(this,function(g){switch(g.label){case 0:if(!(e<a.length))return[3,3];b=a[e];l(b)&&c.push(b);return this._budget.done?[4,this._reschedule()]:[3,2];case 1:return g.sent(),[2,h()];case 2:return++e,[3,0];case 3:return[2]}})})};return[2,this._reschedule().then(function(){return h()}).then(function(){return c})]})})};
a.prototype._canExecuteSoloPass=function(a,b){var l=this.geometryType;b=b.spatialRel;return p.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===l&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};a.prototype._getQueryBBoxes=function(a){if(p.canQueryWithRBush(a)){if(G.isExtent(a))return[D.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(G.isPolygon(a))return a.rings.map(function(a){return D.fromValues(Math.min(a[0][0],a[2][0]),
Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[H.getBoundsXY(D.create(),a)]};a.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){X.add(a)});var l=Array(X.size),e=0;X.forEach(function(a){return l[e++]=a});X.clear();return l};a.prototype._checkQuerySupport=function(a){return b(this,void 0,void 0,function(){return q(this,function(b){if(0>a.distance||null!=a.geometryPrecision||a.multipatchOption||
a.pixelSize||a.relationParam||a.text)throw new c("feature-store:unsupported-query","Unsupported query options",{query:a});return[2,E.all([this._checkAttributesQuerySupport(a),this._checkStatisticsQuerySupport(a),p.checkSpatialQuerySupport(a,this.geometryType,this.spatialReference),r.checkProjectionSupport(this.spatialReference,a.outSR)]).then(function(){return a})]})})};a.prototype._checkAttributesQuerySupport=function(a){var b=a.outFields,l=a.orderByFields,e=a.returnDistinctValues;l&&0<l.length&&
(l=l.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),h.validateFields(this.fieldsIndex,l,"orderByFields contains missing fields"));if(b&&0<b.length)h.validateFields(this.fieldsIndex,b,"outFields contains missing fields");else if(e)throw new c("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:a});h.validateWhere(this.fieldsIndex,a.where)};a.prototype._checkStatisticsQuerySupport=function(a){return b(this,
void 0,void 0,function(){var b,l,e,g,p,m,k,w,r,n,t,u;return q(this,function(A){b=a.outStatistics;l=a.groupByFieldsForStatistics;e=a.having;g=l&&l.length;p=b&&b.length;if(e){if(!g||!p)throw new c("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:a});h.validateHaving(this.fieldsIndex,e,b)}if(p){if(m=b.some(function(a){return"exceedslimit"===a.statisticType}))return[2];k=b.map(function(a){return a.onStatisticField});h.validateFields(this.fieldsIndex,
k,"onStatisticFields contains missing fields");g&&h.validateFields(this.fieldsIndex,l,"groupByFieldsForStatistics contains missing fields");w=0;for(r=b;w<r.length;w++)if(n=r[w],t=n.onStatisticField,u=n.statisticType,(!g||"count"!==u)&&t&&h.hasInvalidFieldType(t,this.fieldsIndex))throw new c("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:n,query:a});}return[2]})})};return a}();a.default=C;var w=F.create(),L=F.create()})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/sql/WhereClauseCache".split(" "),
function(C,a,v,q,b,c){function k(a,b){return a?y.get(a,b):null}function n(a,b,c,y){void 0===y&&(y=!0);for(var x=[],A=0;A<b.length;A++){var h=b[A];if("*"!==h&&!a.has(h))if(y){var r=u(h);try{var e=k(r,a);if(!e)throw new q("feature-store:unsupported-query","invalid SQL expression",{where:r});if(!e.isStandardized)throw new q("feature-store:unsupported-query","expression is not standard",{clause:e});n(a,e.fieldNames,"expression contains missing fields")}catch(g){if((r=g&&g.details)&&(r.clause||r.where))throw g;
r&&r.missingFields?x.push.apply(x,r.missingFields):x.push(h)}}else x.push(h)}if(x.length)throw new q("feature-store:unsupported-query",c,{missingFields:x});}function u(a){return a.split(" as ")[0]}Object.defineProperty(a,"__esModule",{value:!0});var y=new c.WhereClauseCache(50,500),E=b.createSetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.validateWhere=function(a,b){if(!b)return!0;
var c=y.get(b,a);if(!c)throw new q("feature-store:unsupported-query","invalid SQL expression",{where:b});if(!c.isStandardized)throw new q("feature-store:unsupported-query","where clause is not standard",{where:b});n(a,c.fieldNames,"where clause contains missing fields");return!0};a.validateHaving=function(a,b,c){if(!b)return!0;var k=y.get(b,a);if(!k)throw new q("feature-store:unsupported-query","invalid SQL expression",{having:b});if(!k.isAggregate)throw new q("feature-store:unsupported-query","having does not contain a valid aggregate function",
{having:b});n(a,k.fieldNames,"having contains missing fields");if(!k.getExpressions().every(function(b){var k=b.aggregateType;b=b.field;var h=a.has(b)&&a.get(b).name;return c.some(function(b){var e=b.onStatisticField;b=b.statisticType;return(a.has(e)&&a.get(e).name)===h&&b.toLowerCase().trim()===k})}))throw new q("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:b});return!0};a.getWhereClause=k;a.validateFields=n;a.getExpressionFromFieldName=u;a.getAliasFromFieldName=
function(a){return a.split(" as ")[1]};a.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!E.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require","exports","../ItemCache","./WhereClause"],function(C,a,v,q){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(a,b){this._cache=new v(a);this._invalidCache=new v(b)}a.prototype.get=function(a,b){var c=b.uid+":"+a,k=this._cache.get(c);if(k)return k;if(void 0!==this._invalidCache.get(c))return null;try{var y=
q.WhereClause.create(a,b);this._cache.put(c,y);return y}catch(E){return this._invalidCache.put(c,null),null}};return a}();a.WhereClauseCache=C})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(C,a,v){return function(){function a(a,c){this._storage=new v.MemCacheStorage;this._storage.maxSize=a;c&&this._storage.registerRemoveFunc("",c)}a.prototype.put=function(a,c){this._storage.put(a,c,1,1)};a.prototype.pop=function(a){return this._storage.pop(a)};a.prototype.get=
function(a){return this._storage.get(a)};a.prototype.clear=function(){this._storage.clearAll()};a.prototype.destroy=function(){this._storage.clearAll()};return a}()})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../iteratorUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(C,a,v,q,b,c,k){function n(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function u(a,b,e,c,h,g,p,m,k){void 0===e&&(e="0");void 0===c&&(c="0");void 0===
h&&(h="0");void 0===g&&(g="0");void 0===p&&(p="");void 0===m&&(m="0");void 0===k&&(k="0");return"+"===p||"-"===p?(a=n(parseInt(a,10),4)+"-"+n(parseInt(b,10),2)+"-"+n(parseInt(e,10),2),b="",10>parseFloat(g)&&(b="0"),c=n(parseInt(c,10),2)+":"+n(parseInt(h,10),2)+":"+(b+parseFloat(g).toString()),p=""+p+n(parseInt(m,10),2)+":"+n(parseInt(k,10),2),new Date(a+"T"+c+p)):new Date(parseInt(a,10),parseInt(b,10),parseInt(e,10),parseInt(c,10),parseInt(h,10),parseFloat(g))}function y(a){var b=t.exec(a);if(null!==
b){a=b[1];var c=b[2],e=b[3],h=b[4],g=b[5],p=b[6];return u(a,c,e,h,g,p)}b=U.exec(a);if(null!==b){a=b[1];var c=b[2],e=b[3],h=b[4],g=b[5],p=b[6],k=b[7],r=b[8],b=b[9];return u(a,c,e,h,g,p,k,r,b)}b=ba.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],h=b[4],g=b[5],k=b[6],r=b[7],b=b[8],u(a,c,e,h,g,"0",k,r,b);b=ja.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],h=b[4],g=b[5],u(a,c,e,h,g);b=m.exec(a);if(null!==b)return a=b[1],c=b[2],e=b[3],u(a,c,e);throw Error("SQL Invalid Timestamp");}function E(a){a=m.exec(a);
if(null===a)throw Error("SQL Invalid Date");var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function x(a){return Array.isArray(a)?a:[a]}function F(a){return null!==a?!0!==a:null}function D(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function H(a,b){return null!=a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function G(a,b){if(null==a)return null;for(var l=!1,c=0;c<b.length;c++){var e=b[c];if(null==e)l=null;else if(a===e){l=!0;break}}return l}
function A(a,b,c){if(null==a)return null;for(var l="",e=0,h=0;h<b.length;h++){var g=b.charAt(h);switch(e){case 0:g===c?e=1:l=0<="-[]/{}()*+?.\\^$|".indexOf(g)?l+("\\"+g):"%"===g?l+".*":"_"===g?l+".":l+g;break;case 1:l=0<="-[]/{}()*+?.\\^$|".indexOf(g)?l+("\\"+g):l+g,e=0}}return(new RegExp("^"+l+"$")).test(a)}function h(a){return a instanceof Date?a.valueOf():a}function r(a,b,c){if(null==b||null==c)return null;b=h(b);c=h(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>
c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function e(a){for(var b=[],c={},e=0;e<a.length;e++){var g=a[e],h=g.toLowerCase();void 0===c[h]&&(b.push(g),c[h]=1)}return b}function g(a,b,e){if(b instanceof c.SqlInterval)if(e instanceof Date)switch(a){case "+":return new Date(b.valueInMilliseconds()+e.getTime());case "-":return b.valueInMilliseconds()-e.getTime();case "*":return b.valueInMilliseconds()*e.getTime();case "/":return b.valueInMilliseconds()/e.getTime()}else if(e instanceof
c.SqlInterval)switch(a){case "+":return c.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()+e.valueInMilliseconds());case "-":return c.SqlInterval.createFromMilliseconds(b.valueInMilliseconds()-e.valueInMilliseconds());case "*":return b.valueInMilliseconds()*e.valueInMilliseconds();case "/":return b.valueInMilliseconds()/e.valueInMilliseconds()}else b=b.valueInMilliseconds();else if(e instanceof c.SqlInterval)if(b instanceof Date)switch(a){case "+":return new Date(e.valueInMilliseconds()+
b.getTime());case "-":return new Date(b.getTime()-e.valueInMilliseconds());case "*":return b.getTime()*e.valueInMilliseconds();case "/":return b.getTime()/e.valueInMilliseconds()}else e=e.valueInMilliseconds();else if(b instanceof Date&&"number"===typeof e)switch(e*=864E5,b=b.getTime(),a){case "+":return new Date(b+e);case "-":return new Date(b-e);case "*":return new Date(b*e);case "/":return new Date(b/e)}else if(e instanceof Date&&"number"===typeof b)switch(b*=864E5,e=e.getTime(),a){case "+":return new Date(b+
e);case "-":return new Date(b-e);case "*":return new Date(b*e);case "/":return new Date(b/e)}switch(a){case "+":return b+e;case "-":return b-e;case "*":return b*e;case "/":return b/e}}function p(a,b,e,c){a=c.getAttribute(a,b);return null!=a&&1===e[b]?new Date(a):a}Object.defineProperty(a,"__esModule",{value:!0});var m=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,U=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,
ba=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,ja=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,X=function(){function a(){}a.makeBool=function(a){return!0===a};a.featureValue=function(a,b,e,c){return p(a,b,e,c)};a.equalsNull=function(a){return null===a};a.applyLike=function(a,b,e){return A(a,b,e)};a.ensureArray=function(a){return x(a)};a.applyIn=function(a,b){return G(a,b)};a.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};a.makeSqlInterval=
function(a,b,e){return c.SqlInterval.createFromValueAndQualifer(a,b,e)};a.convertInterval=function(a){return a instanceof c.SqlInterval?a.valueInMilliseconds():a};a.currentTimestamp=function(){return new Date};a.compare=function(a,b,e){return r(a,b,e)};a.calculate=function(a,b,e){return g(a,b,e)};a.makeComparable=function(a){return h(a)};a.evaluateFunction=function(a,b){return c.evaluateFunction(a,b)};a.lookup=function(a,b){a=b[a];return void 0===a?null:a};a.between=function(a,b){return null==a||
null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};a.notbetween=function(a,b){return null==a||null==b[0]||null==b[1]?null:a<b[0]||a>b[1]};a.ternaryNot=function(a){return F(a)};a.ternaryAnd=function(a,b){return D(a,b)};a.ternaryOr=function(a,b){return H(a,b)};return a}();C=function(){function m(a,b){this.fieldsIndex=b;this.datefields={};this.parameters={};this.parseTree=k.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var e=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;
this.isStandardized=b;this.isAggregate=e}m.create=function(a,b){return new m(a,b)};Object.defineProperty(m.prototype,"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});m.prototype.testSet=function(b,e){void 0===e&&(e=a.defaultAttributeAdapter);for(var c={},l=function(a){c[a]=b.map(function(b){return e.getAttribute(b,a)})},g=0,h=this.fieldNames;g<h.length;g++)l(h[g]);return!!this.evaluateNode(this.parseTree,{attributes:c},a.defaultAttributeAdapter)};m.prototype.calculateValue=
function(b,e){void 0===e&&(e=a.defaultAttributeAdapter);b=this.evaluateNode(this.parseTree,b,e);return b instanceof c.SqlInterval?b.valueInMilliseconds()/864E5:b};m.prototype.calculateValueCompiled=function(b,e){void 0===e&&(e=a.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(b,this.parameters,e,this.datefields);if(v("csp-restrictions"))return this.calculateValue(b,e);this.compileMe();return this.parseTree._compiledVersion(b,this.parameters,
e,this.datefields)};m.prototype.testFeature=function(b,e){void 0===e&&(e=a.defaultAttributeAdapter);return!!this.evaluateNode(this.parseTree,b,e)};m.prototype.testFeatureCompiled=function(b,e){void 0===e&&(e=a.defaultAttributeAdapter);if(void 0===this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(b,this.parameters,e,this.datefields);if(v("csp-restrictions"))return this.testFeature(b,e);this.compileMe();return!!this.parseTree._compiledVersion(b,this.parameters,e,this.datefields)};
m.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return e(a)};m.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var e=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var c=e+"-"+b;a.has(c)||a.set(c,{aggregateType:e,field:b})}}});return q.valuesOfMap(a)};m.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,
function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return e(a)};m.prototype.compileMe=function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(X)};m.prototype.extractExpressionInfo=function(a){var g=this,l=[],h=!0,p=!0;this.visitAll(this.parseTree,function(e){switch(e.type){case "column_ref":var m=e.column.toUpperCase();if("CURRENT_DATE"!==
m&&"CURRENT_TIMESTAMP"!==m){var k=(m=a.get(e.column))&&m.name;!m||"date"!==m.type&&"esriFieldTypeDate"!==m.type||(g.datefields[m.name]=1);void 0!==k?(l.push(k),e.column=k):l.push(e.column)}break;case "function":m=e.name,e=e.args.value.length,h&&(h=c.isStandardized(m,e)),p&&(p=b.isAggregate(m,e))}});return{referencedFieldNames:e(l),isStandardized:h,isAggregate:p}};m.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);
break;case "case_expression":for(var e=0,c=a.clauses;e<c.length;e++){var g=c[e];this.visitAll(g,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":e=0;for(a=a.value;e<a.length;e++)g=a[e],this.visitAll(g,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};m.prototype.evaluateNodeToJavaScript=function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+
this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var e="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",c=0;c<a.clauses.length;c++)b+=" ("+e+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[c].operand)+")) ? ("+this.evaluateNodeToJavaScript(a.clauses[c].value)+") : ";else for(b="( ",c=0;c<a.clauses.length;c++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[c].operand)+
")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(a.clauses[c].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";e=0;for(a=a.value;e<a.length;e++)c=a[e],"["!==b&&(b+=","),b+=this.evaluateNodeToJavaScript(c);return b+"]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+
this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);case "date":return"(new Date("+E(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+y(a.value).getTime().toString()+"))";case "column_ref":return"CURRENT_DATE"===
a.column.toUpperCase()?"this.currentDate()":"CURRENT_TIMESTAMP"===a.column.toUpperCase()?"this.currentTimestamp()":"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+a.type);};m.prototype.evaluateNode=function(a,e,m){switch(a.type){case "interval":return e=this.evaluateNode(a.value,e,m),c.SqlInterval.createFromValueAndQualifer(e,
a.qualifier,a.op);case "case_expression":if("simple"===a.format)for(var k=h(this.evaluateNode(a.operand,e,m)),l=0;l<a.clauses.length;l++){if(k===h(this.evaluateNode(a.clauses[l].operand,e,m)))return this.evaluateNode(a.clauses[l].value,e,m)}else for(l=0;l<a.clauses.length;l++)if(!0===this.evaluateNode(a.clauses[l].operand,e,m))return this.evaluateNode(a.clauses[l].value,e,m);return null!==a.else?this.evaluateNode(a.else,e,m):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":k=
[];l=0;for(a=a.value;l<a.length;l++){var n=a[l];k.push(this.evaluateNode(n,e,m))}return k;case "unary_expr":return F(this.evaluateNode(a.expr,e,m));case "binary_expr":switch(a.operator){case "AND":return D(this.evaluateNode(a.left,e,m),this.evaluateNode(a.right,e,m));case "OR":return H(this.evaluateNode(a.left,e,m),this.evaluateNode(a.right,e,m));case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,e,m);case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");
return null!==this.evaluateNode(a.left,e,m);case "IN":return k=x(this.evaluateNode(a.right,e,m)),G(this.evaluateNode(a.left,e,m),k);case "NOT IN":return k=x(this.evaluateNode(a.right,e,m)),F(G(this.evaluateNode(a.left,e,m),k));case "BETWEEN":return k=this.evaluateNode(a.left,e,m),a=this.evaluateNode(a.right,e,m),null==k||null==a[0]||null==a[1]?null:k>=h(a[0])&&k<=h(a[1]);case "NOTBETWEEN":return k=this.evaluateNode(a.left,e,m),a=this.evaluateNode(a.right,e,m),null==k||null==a[0]||null==a[1]?null:
k<h(a[0])||k>h(a[1]);case "LIKE":return A(this.evaluateNode(a.left,e,m),this.evaluateNode(a.right,e,m),a.escape);case "NOT LIKE":return F(A(this.evaluateNode(a.left,e,m),this.evaluateNode(a.right,e,m),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return r(a.operator,this.evaluateNode(a.left,e,m),this.evaluateNode(a.right,e,m));case "-":case "+":case "*":case "/":return g(a.operator,this.evaluateNode(a.left,e,m),this.evaluateNode(a.right,e,m))}throw Error("Not Supported Operator "+
a.operator);case "null":case "bool":case "string":case "number":return a.value;case "date":return E(a.value);case "timestamp":return y(a.value);case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?(n=new Date,n.setHours(0,0,0,0),n):"CURRENT_TIMESTAMP"===a.column.toUpperCase()?new Date:p(e,a.column,this.datefields,m);case "function":return e=this.evaluateNode(a.args,e,m),this.isAggregate?b.aggregateFunction(a.name,e):c.evaluateFunction(a.name,e)}throw Error("Unsupported sql syntax "+a.type);
};return m}();a.WhereClause=C;a.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(C,a){function v(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}function q(a){for(var b=v(a),c=a.length,u=0,q=0;q<a.length;q++)u+=Math.pow(a[q]-b,2);return 1<c?u/(c-1):0}Object.defineProperty(a,"__esModule",{value:!0});a.aggregateFunction=function(a,k){var c=
b[a.toLowerCase()];if(null==c)throw Error("Function Not Recognised");if(k.length<c.minParams||k.length>c.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return c.evaluate(k)};a.isAggregate=function(a,k){a=b[a.toLowerCase()];return null!=a&&k>=a.minParams&&k<=a.maxParams};var b={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,
a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:v(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(q(a[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:q(a[0])}}}})},
"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","../string"],function(C,a,v){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}a.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};a.createFromMilliseconds=function(b){var c=new a;c.second=b/1E3;return c};a.createFromValueAndQualifer=
function(b,k,n){var c=null,q=new a;q.op="-"===n?"-":"+";if("interval-period"===k.type){a.fixDefaults(k);if("year"===k.period||"month"===k.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(b))q[k.period]=parseFloat(b);else throw Error("Illegal Interval");}else{a.fixDefaults(k.start);a.fixDefaults(k.end);if("year"===k.start.period||"month"===k.start.period)throw Error("Year-Month Intervals not supported");if("year"===k.end.period||"month"===k.end.period)throw Error("Year-Month Intervals not supported");
switch(k.start.period){case "day":switch(k.end.period){case "hour":c=/^[0-9]{1,} [0-9]{1,}$/;if(c.test(b))q[k.start.period]=parseFloat(b.split(" ")[0]),q[k.end.period]=parseFloat(b.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":c=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(c.test(b))q[k.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),q.hour=parseFloat(b[0]),q.minute=parseFloat(b[1]);else throw Error("Illegal Interval");break;case "second":c=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;
if(c.test(b))q[k.start.period]=parseFloat(b.split(" ")[0]),b=b.split(" ")[1].split(":"),q.hour=parseFloat(b[0]),q.minute=parseFloat(b[1]),q.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(k.end.period){case "minute":c=/^[0-9]{1,}:[0-9]{1,}$/;if(c.test(b))q.hour=parseFloat(b.split(":")[0]),q.minute=parseFloat(b.split(":")[1]);else throw Error("Illegal Interval");break;case "second":c=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;
if(c.test(b))b=b.split(":"),q.hour=parseFloat(b[0]),q.minute=parseFloat(b[1]),q.second=parseFloat(b[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(k.end.period){case "second":c=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(c.test(b))b=b.split(":"),q.minute=parseFloat(b[0]),q.second=parseFloat(b[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return q};a.prototype.valueInMilliseconds=
function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return a}();a.SqlInterval=C;a.evaluateFunction=function(a,c){var b=q[a.toLowerCase()];if(null==b)throw Error("Function Not Recognised");if(c.length<b.minParams||c.length>b.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return b.evaluate(c)};a.isStandardized=function(a,c){a=q[a.toLowerCase()];return null!=a&&c>=a.minParams&&
c<=a.maxParams};var q={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=
a[0],k=a[1];return null==b||null==k?null:b.toString().substring(k-1)}if(3===a.length)return b=a[0],k=a[1],a=a[2],null==b||null==k||null==a?null:0>=a?"":b.toString().substring(k-1,k+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,k=b?a[1]:" ",b=b?a[2]:a[1];if(null==k||null==b)return null;k="("+v.escapeRegExpString(k)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+
k+"*|"+k+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+k+"*","g"),"");case "TRAILING":return b.replace(new RegExp(k+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,
evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?
null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%
a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",k=0;k<
a.length;k++){if(null==a[k])return null;b+=a[k].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(C,a,v){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(){}a.parse=function(a){return v.parse(a)};
return a}();a.WhereGrammar=C})},"esri/core/sql/sql92grammar":function(){define([],function(){function C(a,v,q,b){this.message=a;this.expected=v;this.found=q;this.location=b;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,C)}(function(a,v){function q(){this.constructor=a}q.prototype=v.prototype;a.prototype=new q})(C,Error);C.buildMessage=function(a,v){function q(a){return a.charCodeAt(0).toString(16).toUpperCase()}function b(a){return a.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+q(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+q(a)})}function c(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+q(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(a){return"\\x"+q(a)})}var k={literal:function(a){return'"'+b(a.text)+'"'},"class":function(a){var b="",k;for(k=0;k<a.parts.length;k++)b+=a.parts[k]instanceof Array?c(a.parts[k][0])+"-"+c(a.parts[k][1]):c(a.parts[k]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var n=c,q;q=a[c];q=k[q.type](q);b[n]=q}b.sort();
if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(a)+" but "+(v?'"'+b(v)+'"':"end of input")+" found."};return{SyntaxError:C,parse:function(a,v){function q(a,d){return{type:"literal",text:a,ignoreCase:d}}function b(a,d,b){return{type:"class",parts:a,inverted:d,ignoreCase:b}}function c(d){var b=Ia[d],e;if(!b){for(e=d-1;!Ia[e];)e--;b=Ia[e];
for(b={line:b.line,column:b.column};e<d;)10===a.charCodeAt(e)?(b.line++,b.column=1):b.column++,e++;Ia[d]=b}return b}function k(a,d){var b=c(a),e=c(d);return{start:{offset:a,line:b.line,column:b.column},end:{offset:d,line:e.line,column:e.column}}}function n(a){f<da||(f>da&&(da=f,Qa=[]),Qa.push(a))}function u(){var a,b,e;a=f;b=B();b!==d?(b=E(),b!==d?(e=B(),e!==d?a=b:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function y(){var a,b,e,c,g,h,m,p;a=f;b=E();if(b!==d){e=[];c=f;g=B();g!==d?(h=Aa(),h!==d?(m=B(),
m!==d?(p=E(),p!==d?c=g=[g,h,m,p]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);for(;c!==d;)e.push(c),c=f,g=B(),g!==d?(h=Aa(),h!==d?(m=B(),m!==d?(p=E(),p!==d?c=g=[g,h,m,p]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);if(e!==d){a={type:"expr_list"};b=[b];for(c=0;c<e.length;c++)b.push(e[c][3]);a.value=b}else f=a,a=d}else f=a,a=d;return a}function E(){var a,b,e,c,g,h,m,p;a=f;b=x();if(b!==d){e=[];c=f;g=B();g!==d?(h=la(),h!==d?(m=B(),m!==d?(p=x(),p!==d?c=g=[g,h,m,p]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);
for(;c!==d;)e.push(c),c=f,g=B(),g!==d?(h=la(),h!==d?(m=B(),m!==d?(p=x(),p!==d?c=g=[g,h,m,p]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);e!==d?a=b=Ba(b,e):(f=a,a=d)}else f=a,a=d;return a}function x(){var a,b,e,c,g,h,m,p;a=f;b=F();if(b!==d){e=[];c=f;g=B();g!==d?(h=fa(),h!==d?(m=B(),m!==d?(p=F(),p!==d?c=g=[g,h,m,p]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);for(;c!==d;)e.push(c),c=f,g=B(),g!==d?(h=fa(),h!==d?(m=B(),m!==d?(p=F(),p!==d?c=g=[g,h,m,p]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);e!==d?a=b=
Ba(b,e):(f=a,a=d)}else f=a,a=d;return a}function F(){var b,e,c,g,h;b=f;e=ka();e===d&&(e=f,33===a.charCodeAt(f)?(c=$c,f++):(c=d,0===z&&n(ad)),c!==d?(g=f,z++,61===a.charCodeAt(f)?(h=bb,f++):(h=d,0===z&&n(cb)),z--,h===d?g=void 0:(f=g,g=d),g!==d?e=c=[c,g]:(f=e,e=d)):(f=e,e=d));e!==d?(c=B(),c!==d?(g=F(),g!==d?b=e={type:"unary_expr",operator:"NOT",expr:g}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d);if(b===d)if(b=f,e=A(),e!==d)if(c=B(),c!==d){var m,p,k;c=[];g=f;h=B();h!==d?(m=D(),m!==d?(p=B(),p!==d?(k=A(),k!==d?g=h=
[h,m,p,k]:(f=g,g=d)):(f=g,g=d)):(f=g,g=d)):(f=g,g=d);if(g!==d)for(;g!==d;)c.push(g),g=f,h=B(),h!==d?(m=D(),m!==d?(p=B(),p!==d?(k=A(),k!==d?g=h=[h,m,p,k]:(f=g,g=d)):(f=g,g=d)):(f=g,g=d)):(f=g,g=d);else c=d;c!==d&&(c={type:"arithmetic",tail:c});c===d&&(c=f,g=G(),g!==d?(h=B(),h!==d?(h=ga(),h!==d?(h=B(),h!==d?(h=y(),h!==d?(m=B(),m!==d?(m=ha(),m!==d?c=g={op:g,right:h}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,g=G(),g!==d?(h=B(),h!==d?(h=ga(),h!==d?(h=B(),h!==
d?(h=ha(),h!==d?c=g={op:g,right:{type:"expr_list",value:[]}}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,g=G(),g!==d?(h=B(),h!==d?(h=ba(),h!==d?c=g={op:g,right:h}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d))),c===d&&(c=f,h=ka(),h!==d?(g=B(),g!==d?(g=ma(),g!==d?(m=B(),m!==d?(m=A(),m!==d?(p=B(),p!==d?(p=fa(),p!==d?(h=B(),h!==d?(h=A(),h!==d?c=h={op:"NOT"+g,right:{type:"expr_list",value:[m,h]}}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),
c===d&&(c=f,h=ma(),h!==d?(g=B(),g!==d?(g=A(),g!==d?(m=B(),m!==d?(m=fa(),m!==d?(p=B(),p!==d?(p=A(),p!==d?c=h={op:h,right:{type:"expr_list",value:[g,p]}}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)),c===d&&(c=f,g=V(),g!==d?(h=B(),h!==d?(h=ka(),h!==d?(h=B(),h!==d?(h=A(),h!==d?c=g={op:g+"NOT",right:h}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,g=V(),g!==d?(h=B(),h!==d?(h=A(),h!==d?c=g={op:g,right:h}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)),c===d&&(c=f,g=
H(),g!==d?(h=B(),h!==d?(h=L(),h!==d?(m=B(),m!==d?(m=f,a.substr(f,6).toLowerCase()===bd?(p=a.substr(f,6),f+=6):(p=d,0===z&&n(cd)),p!==d?(p=f,z++,k=t(),z--,k===d?p=void 0:(f=p,p=d),p!==d?m="ESCAPE":(f=m,m=d)):(f=m,m=d),m!==d?(m=B(),m!==d?(m=M(),m!==d?c=g={op:g,right:h,escape:m.value}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,g=H(),g!==d?(h=B(),h!==d?(h=L(),h!==d?c=g={op:g,right:h,escape:""}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d))))));c===d&&(c=null);c!==d?(b=e,
e=c,""==e||void 0==e||null==e?e=b:(c=null,e=c="arithmetic"==e.type?Ba(b,e.tail):db(e.op,b,e.right,e.escape)),b=e):(f=b,b=d)}else f=b,b=d;else f=b,b=d;return b}function D(){var b;a.substr(f,2)===eb?(b=eb,f+=2):(b=d,0===z&&n(dd));b===d&&(62===a.charCodeAt(f)?(b=ed,f++):(b=d,0===z&&n(fd)),b===d&&(a.substr(f,2)===fb?(b=fb,f+=2):(b=d,0===z&&n(gd)),b===d&&(a.substr(f,2)===gb?(b=gb,f+=2):(b=d,0===z&&n(hd)),b===d&&(60===a.charCodeAt(f)?(b=id,f++):(b=d,0===z&&n(jd)),b===d&&(61===a.charCodeAt(f)?(b=bb,f++):
(b=d,0===z&&n(cb)),b===d&&(a.substr(f,2)===hb?(b=hb,f+=2):(b=d,0===z&&n(kd))))))));return b}function H(){var a,b,e,c;a=a=f;b=ka();b!==d?(e=B(),e!==d?(c=ua(),c!==d?a=b=[b,e,c]:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);a!==d&&(a=a[0]+" "+a[2]);a===d&&(a=ua());return a}function G(){var a,b,e,c;a=a=f;b=ka();b!==d?(e=B(),e!==d?(c=Y(),c!==d?a=b=[b,e,c]:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);a!==d&&(a=a[0]+" "+a[2]);a===d&&(a=Y());return a}function A(){var a,b,e,c,g,m,p,k;a=f;b=r();if(b!==d){e=[];c=f;g=B();g!==d?(m=h(),
m!==d?(p=B(),p!==d?(k=r(),k!==d?c=g=[g,m,p,k]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);for(;c!==d;)e.push(c),c=f,g=B(),g!==d?(m=h(),m!==d?(p=B(),p!==d?(k=r(),k!==d?c=g=[g,m,p,k]:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);e!==d?a=b=Ba(b,e):(f=a,a=d)}else f=a,a=d;return a}function h(){var b;43===a.charCodeAt(f)?(b=bc,f++):(b=d,0===z&&n(cc));b===d&&(45===a.charCodeAt(f)?(b=dc,f++):(b=d,0===z&&n(ec)));return b}function r(){var a,b,c,h,m,p,k,l;a=f;b=g();if(b!==d){c=[];h=f;m=B();m!==d?(p=e(),p!==d?(k=
B(),k!==d?(l=g(),l!==d?h=m=[m,p,k,l]:(f=h,h=d)):(f=h,h=d)):(f=h,h=d)):(f=h,h=d);for(;h!==d;)c.push(h),h=f,m=B(),m!==d?(p=e(),p!==d?(k=B(),k!==d?(l=g(),l!==d?h=m=[m,p,k,l]:(f=h,h=d)):(f=h,h=d)):(f=h,h=d)):(f=h,h=d);c!==d?a=b=Ba(b,c):(f=a,a=d)}else f=a,a=d;return a}function e(){var b;42===a.charCodeAt(f)?(b=ld,f++):(b=d,0===z&&n(md));b===d&&(47===a.charCodeAt(f)?(b=nd,f++):(b=d,0===z&&n(od)));return b}function g(){var b,c,e,g,h,k,l;l=M();if(l===d){var r,A,q,u;r=f;var w,x,F,D;w=f;x=oa();x!==d?(F=N(),
F!==d?(D=Z(),D!==d?w=x=parseFloat(x+F+D):(f=w,w=d)):(f=w,w=d)):(f=w,w=d);w===d&&(w=f,x=oa(),x!==d?(F=N(),F!==d?w=x=parseFloat(x+F):(f=w,w=d)):(f=w,w=d),w===d&&(w=f,x=oa(),x!==d?(F=Z(),F!==d?w=x=parseFloat(x+F):(f=w,w=d)):(f=w,w=d),w===d&&(w=f,x=oa(),x!==d&&(x=parseFloat(x)),w=x)));A=w;A!==d?(q=f,z++,u=m(),z--,u===d?q=void 0:(f=q,q=d),q!==d?r=A={type:"number",value:A}:(f=r,r=d)):(f=r,r=d);l=r;if(l===d){var I,v;I=f;var H,C,G,W;H=f;a.substr(f,4).toLowerCase()===pd?(C=a.substr(f,4),f+=4):(C=d,0===z&&
n(qd));C!==d?(G=f,z++,W=t(),z--,W===d?G=void 0:(f=G,G=d),G!==d?H=C=[C,G]:(f=H,H=d)):(f=H,H=d);v=H;v!==d&&(v={type:"bool",value:!0});I=v;if(I===d){I=f;var V,aa,da,ua;V=f;a.substr(f,5).toLowerCase()===rd?(aa=a.substr(f,5),f+=5):(aa=d,0===z&&n(sd));aa!==d?(da=f,z++,ua=t(),z--,ua===d?da=void 0:(f=da,da=d),da!==d?V=aa=[aa,da]:(f=V,V=d)):(f=V,V=d);v=V;v!==d&&(v={type:"bool",value:!1});I=v}l=I;if(l===d){var ka,fa,ma,la,Ba;fa=f;a.substr(f,4).toLowerCase()===td?(ma=a.substr(f,4),f+=4):(ma=d,0===z&&n(ud));
ma!==d?(la=f,z++,Ba=t(),z--,Ba===d?la=void 0:(f=la,la=d),la!==d?fa=ma=[ma,la]:(f=fa,fa=d)):(f=fa,fa=d);ka=fa;ka!==d&&(ka={type:"null",value:null});l=ka;if(l===d){var xa,Aa,Ia,Ea;xa=f;var Ja,za,ib,Qa;Ja=f;a.substr(f,4).toLowerCase()===vd?(za=a.substr(f,4),f+=4):(za=d,0===z&&n(wd));za!==d?(ib=f,z++,Qa=t(),z--,Qa===d?ib=void 0:(f=ib,ib=d),ib!==d?Ja=za="DATE":(f=Ja,Ja=d)):(f=Ja,Ja=d);Aa=Ja;Aa!==d?(Ia=B(),Ia!==d?(Ea=L(),Ea!==d?xa=Aa={type:"date",value:Ea.value}:(f=xa,xa=d)):(f=xa,xa=d)):(f=xa,xa=d);l=
xa;if(l===d){var ya,fc,$a,gc;ya=f;var Ka,Gb,jb,ab;Ka=f;a.substr(f,9).toLowerCase()===xd?(Gb=a.substr(f,9),f+=9):(Gb=d,0===z&&n(yd));Gb!==d?(jb=f,z++,ab=t(),z--,ab===d?jb=void 0:(f=jb,jb=d),jb!==d?Ka=Gb="TIMESTAMP":(f=Ka,Ka=d)):(f=Ka,Ka=d);fc=Ka;fc!==d?($a=B(),$a!==d?(gc=L(),gc!==d?ya=fc={type:"timestamp",value:gc.value}:(f=ya,ya=d)):(f=ya,ya=d)):(f=ya,ya=d);l=ya;if(l===d){var O,Ra,Hb,va,Ib,Sa,bb,hc;O=f;Ra=uc();Ra!==d?(Hb=B(),Hb!==d?(45===a.charCodeAt(f)?(va=dc,f++):(va=d,0===z&&n(ec)),va===d&&(43===
a.charCodeAt(f)?(va=bc,f++):(va=d,0===z&&n(cc))),va!==d?(Ib=B(),Ib!==d?(Sa=L(),Sa!==d?(bb=B(),bb!==d?(hc=X(),hc!==d?O=Ra={type:"interval",value:Sa,qualifier:hc,op:va}:(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d);O===d&&(O=f,Ra=uc(),Ra!==d?(Hb=B(),Hb!==d?(va=L(),va!==d?(Ib=B(),Ib!==d?(Sa=X(),Sa!==d?O=Ra={type:"interval",value:va,qualifier:Sa,op:""}:(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d)):(f=O,O=d));l=O}}}}}}b=l;if(b===d){var S,ic,cb,db,eb,jc,fb,gb,hb,kc,tb,ub;S=f;
var La,Jb,kb,vb;La=f;a.substr(f,7).toLowerCase()===zd?(Jb=a.substr(f,7),f+=7):(Jb=d,0===z&&n(Ad));Jb!==d?(kb=f,z++,vb=t(),z--,vb===d?kb=void 0:(f=kb,kb=d),kb!==d?La=Jb="EXTRACT":(f=La,La=d)):(f=La,La=d);ic=La;if(ic!==d)if(cb=B(),cb!==d)if(db=ga(),db!==d)if(eb=B(),eb!==d){var pa;pa=vc();pa===d&&(pa=wc(),pa===d&&(pa=xc(),pa===d&&(pa=yc(),pa===d&&(pa=zc(),pa===d&&(pa=Ha())))));jc=pa;jc!==d?(fb=B(),fb!==d?(gb=Fa(),gb!==d?(hb=B(),hb!==d?(kc=E(),kc!==d?(tb=B(),tb!==d?(ub=ha(),ub!==d?S=ic={type:"function",
name:"extract",args:{type:"expr_list",value:[{type:"string",value:jc},kc]}}:(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)):(f=S,S=d)}else f=S,S=d;else f=S,S=d;else f=S,S=d;else f=S,S=d;b=S;if(b===d){var Q,lc,wb,xb,yb,Kb,zb,Ab,Bb,Lb,Cb,ia,Ta,mc,nc,oc;Q=f;var Ma,Mb,lb,Db;Ma=f;a.substr(f,9).toLowerCase()===Bd?(Mb=a.substr(f,9),f+=9):(Mb=d,0===z&&n(Cd));Mb!==d?(lb=f,z++,Db=t(),z--,Db===d?lb=void 0:(f=lb,lb=d),lb!==d?Ma=Mb="SUBSTRING":(f=Ma,Ma=d)):(f=Ma,Ma=d);lc=Ma;if(lc!==d)if(wb=B(),
wb!==d)if(xb=ga(),xb!==d)if(yb=B(),yb!==d)if(Kb=E(),Kb!==d)if(zb=B(),zb!==d)if(Ab=Fa(),Ab!==d)if(Bb=B(),Bb!==d)if(Lb=E(),Lb!==d)if(Cb=B(),Cb!==d){ia=f;var Na,Nb,mb,Ac;Na=f;a.substr(f,3).toLowerCase()===Dd?(Nb=a.substr(f,3),f+=3):(Nb=d,0===z&&n(Ed));Nb!==d?(mb=f,z++,Ac=t(),z--,Ac===d?mb=void 0:(f=mb,mb=d),mb!==d?Na=Nb="FOR":(f=Na,Na=d)):(f=Na,Na=d);Ta=Na;Ta!==d?(mc=B(),mc!==d?(nc=E(),nc!==d?(oc=B(),oc!==d?ia=Ta=[Ta,mc,nc,oc]:(f=ia,ia=d)):(f=ia,ia=d)):(f=ia,ia=d)):(f=ia,ia=d);ia===d&&(ia=null);ia!==
d?(Ta=ha(),Ta!==d?Q=lc={type:"function",name:"substring",args:{type:"expr_list",value:ia?[Kb,Lb,ia[2]]:[Kb,Lb]}}:(f=Q,Q=d)):(f=Q,Q=d)}else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;else f=Q,Q=d;b=Q;if(b===d){var J,Ua,Ob,Pb,Qb,qa,Rb,Va,Sb,Tb,Bc,pc,Cc,Dc;J=f;Ua=Ga();Ua!==d?(Ob=B(),Ob!==d?(Pb=ga(),Pb!==d?(Qb=B(),Qb!==d?(qa=ja(),qa===d&&(qa=null),qa!==d?(Rb=B(),Rb!==d?(Va=E(),Va!==d?(Sb=B(),Sb!==d?(Tb=Fa(),Tb!==d?(Bc=B(),Bc!==d?(pc=
E(),pc!==d?(Cc=B(),Cc!==d?(Dc=ha(),Dc!==d?J=Ua={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==qa?"BOTH":qa},Va,pc]}}:(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d);J===d&&(J=f,Ua=Ga(),Ua!==d?(Ob=B(),Ob!==d?(Pb=ga(),Pb!==d?(Qb=B(),Qb!==d?(qa=ja(),qa===d&&(qa=null),qa!==d?(Rb=B(),Rb!==d?(Va=E(),Va!==d?(Sb=B(),Sb!==d?(Tb=ha(),Tb!==d?J=Ua={type:"function",name:"trim",args:{type:"expr_list",
value:[{type:"string",value:null==qa?"BOTH":qa},Va]}}:(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d)):(f=J,J=d));b=J;if(b===d){var T,qc,Ec,Fc,Gc,rc,Hc,Ic,Jc,sc,Kc,Lc;T=f;var Oa,Ub,nb,Mc;Oa=f;a.substr(f,8).toLowerCase()===Fd?(Ub=a.substr(f,8),f+=8):(Ub=d,0===z&&n(Gd));Ub!==d?(nb=f,z++,Mc=t(),z--,Mc===d?nb=void 0:(f=nb,nb=d),nb!==d?Oa=Ub="POSITION":(f=Oa,Oa=d)):(f=Oa,Oa=d);qc=Oa;qc!==d?(Ec=B(),Ec!==d?(Fc=ga(),Fc!==d?(Gc=B(),Gc!==d?(rc=E(),rc!==d?(Hc=B(),Hc!==
d?(Ic=Y(),Ic!==d?(Jc=B(),Jc!==d?(sc=E(),sc!==d?(Kc=B(),Kc!==d?(Lc=ha(),Lc!==d?T=qc={type:"function",name:"position",args:{type:"expr_list",value:[rc,sc]}}:(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d)):(f=T,T=d);b=T;if(b===d){var ea,Vb,Nc,Oc,Pc,Wa,Qc,Rc;ea=f;var ra,ob,pb,wa;ra=f;ra=ob=p();if(ra===d)if(ra=f,96===a.charCodeAt(f)?(ob=Sc,f++):(ob=d,0===z&&n(Tc)),ob!==d){pb=[];Uc.test(a.charAt(f))?(wa=a.charAt(f),f++):(wa=d,0===z&&n(Vc));if(wa!==
d)for(;wa!==d;)pb.push(wa),Uc.test(a.charAt(f))?(wa=a.charAt(f),f++):(wa=d,0===z&&n(Vc));else pb=d;pb!==d?(96===a.charCodeAt(f)?(wa=Sc,f++):(wa=d,0===z&&n(Tc)),wa!==d?ra=ob=pb.join(""):(f=ra,ra=d)):(f=ra,ra=d)}else f=ra,ra=d;Vb=ra;Vb!==d?(Nc=B(),Nc!==d?(Oc=ga(),Oc!==d?(Pc=B(),Pc!==d?(Wa=y(),Wa===d&&(Wa=null),Wa!==d?(Qc=B(),Qc!==d?(Rc=ha(),Rc!==d?ea=Vb={type:"function",name:Vb,args:Wa?Wa:{type:"expr_list",value:[]}}:(f=ea,ea=d)):(f=ea,ea=d)):(f=ea,ea=d)):(f=ea,ea=d)):(f=ea,ea=d)):(f=ea,ea=d)):(f=ea,
ea=d);b=ea;if(b===d){var Wb,K,Xa,Xb,Ya,Yb,Ca,sa,qb,Wc,Xc;K=f;Xa=Eb();if(Xa!==d)if(Xb=B(),Xb!==d)if(Ya=E(),Ya!==d)if(Yb=B(),Yb!==d){Ca=[];for(sa=ca();sa!==d;)Ca.push(sa),sa=ca();Ca!==d?(sa=B(),sa!==d?(qb=Fb(),qb!==d?K=Xa={type:"case_expression",format:"simple",operand:Ya,clauses:Ca,else:null}:(f=K,K=d)):(f=K,K=d)):(f=K,K=d)}else f=K,K=d;else f=K,K=d;else f=K,K=d;else f=K,K=d;if(K===d)if(K=f,Xa=Eb(),Xa!==d)if(Xb=B(),Xb!==d)if(Ya=E(),Ya!==d)if(Yb=B(),Yb!==d){Ca=[];for(sa=ca();sa!==d;)Ca.push(sa),sa=
ca();Ca!==d?(sa=B(),sa!==d?(qb=na(),qb!==d?(Wc=B(),Wc!==d?(Xc=Fb(),Xc!==d?K=Xa={type:"case_expression",format:"simple",operand:Ya,clauses:Ca,else:qb.value}:(f=K,K=d)):(f=K,K=d)):(f=K,K=d)):(f=K,K=d)):(f=K,K=d)}else f=K,K=d;else f=K,K=d;else f=K,K=d;else f=K,K=d;Wb=K;if(Wb===d){var P,Za,Zb,Da,ta,rb,Yc,Zc;P=f;Za=Eb();if(Za!==d)if(Zb=B(),Zb!==d){Da=[];for(ta=R();ta!==d;)Da.push(ta),ta=R();Da!==d?(ta=B(),ta!==d?(rb=Fb(),rb!==d?P=Za={type:"case_expression",format:"searched",clauses:Da,else:null}:(f=P,
P=d)):(f=P,P=d)):(f=P,P=d)}else f=P,P=d;else f=P,P=d;if(P===d)if(P=f,Za=Eb(),Za!==d)if(Zb=B(),Zb!==d){Da=[];for(ta=R();ta!==d;)Da.push(ta),ta=R();Da!==d?(ta=B(),ta!==d?(rb=na(),rb!==d?(Yc=B(),Yc!==d?(Zc=Fb(),Zc!==d?P=Za={type:"case_expression",format:"searched",clauses:Da,else:rb.value}:(f=P,P=d)):(f=P,P=d)):(f=P,P=d)):(f=P,P=d)):(f=P,P=d)}else f=P,P=d;else f=P,P=d;Wb=P}b=Wb;if(b===d){var sb,Pa,tc,$b,ac;Pa=f;tc=m();if(tc!==d){$b=[];for(ac=U();ac!==d;)$b.push(ac),ac=U();$b!==d?Pa=tc+=$b.join(""):(f=
Pa,Pa=d)}else f=Pa,Pa=d;sb=Pa;sb!==d&&(sb={type:"column_ref",table:"",column:sb});b=sb;b===d&&(b=ba(),b===d&&(b=f,c=ga(),c!==d?(e=B(),e!==d?(g=E(),g!==d?(h=B(),h!==d?(k=ha(),k!==d?(g.paren=!0,b=c=g):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)))}}}}}}}return b}function p(){var a,b,c,e;a=f;b=m();if(b!==d){c=[];for(e=t();e!==d;)c.push(e),e=t();c!==d?a=b+=c.join(""):(f=a,a=d)}else f=a,a=d;return a}function m(){var b;Hd.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===z&&n(Id));return b}function t(){var b;
Jd.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===z&&n(Kd));return b}function U(){var b;Ld.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===z&&n(Md));return b}function ba(){var b,c,e;b=f;64===a.charCodeAt(f)?(c=Nd,f++):(c=d,0===z&&n(Od));c!==d?(e=p(),e!==d?b=c=[c,e]:(f=b,b=d)):(f=b,b=d);b!==d&&(b={type:"param",value:b[1]});return b}function ja(){var b,c,e;b=f;a.substr(f,7).toLowerCase()===Pd?(c=a.substr(f,7),f+=7):(c=d,0===z&&n(Qd));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="LEADING":
(f=b,b=d)):(f=b,b=d);b===d&&(b=f,a.substr(f,8).toLowerCase()===Rd?(c=a.substr(f,8),f+=8):(c=d,0===z&&n(Sd)),c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="TRAILING":(f=b,b=d)):(f=b,b=d),b===d&&(b=f,a.substr(f,4).toLowerCase()===Td?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(Ud)),c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="BOTH":(f=b,b=d)):(f=b,b=d)));return b}function X(){var b,c,e;b=f;var g,h;c=f;e=I();e!==d?(g=B(),g!==d?(g=ga(),g!==d?(g=B(),g!==d?(g=w(),g!==d?(h=B(),h!==d?(h=
ha(),h!==d?c=e={type:"interval-period",period:e.value,precision:g,secondary:null}:(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d)):(f=c,c=d);c===d&&(c=f,e=I(),e!==d&&(e=tb(e)),c=e);if(c!==d)if(e=B(),e!==d)if(e=f,a.substr(f,2).toLowerCase()===Vd?(g=a.substr(f,2),f+=2):(g=d,0===z&&n(Wd)),g!==d?(g=f,z++,h=t(),z--,h===d?g=void 0:(f=g,g=d),g!==d?e="TO":(f=e,e=d)):(f=e,e=d),e!==d)if(e=B(),e!==d){var m;e=f;g=I();g!==d&&(g={type:"interval-period",period:g.value,precision:null,secondary:null});
e=g;e===d&&(e=f,g=Ha(),g!==d?(g=B(),g!==d?(g=ga(),g!==d?(g=B(),g!==d?(g=w(),g!==d?(h=B(),h!==d?(h=Aa(),h!==d?(h=B(),h!==d?(h=l(),h!==d?(m=B(),m!==d?(m=ha(),m!==d?e=g=ub(g,h):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,g=Ha(),g!==d?(g=B(),g!==d?(g=ga(),g!==d?(g=B(),g!==d?(g=w(),g!==d?(h=B(),h!==d?(h=ha(),h!==d?e=g={type:"interval-period",period:"second",precision:g,secondary:null}:(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):
(f=e,e=d)):(f=e,e=d)):(f=e,e=d)):(f=e,e=d),e===d&&(e=f,g=Ha(),g!==d&&(g={type:"interval-period",period:"second",precision:null,secondary:null}),e=g)));e!==d?b=c={type:"interval-qualifier",start:c,end:e}:(f=b,b=d)}else f=b,b=d;else f=b,b=d;else f=b,b=d;else f=b,b=d;b===d&&(b=f,e=I(),e!==d?(c=B(),c!==d?(c=ga(),c!==d?(c=B(),c!==d?(c=l(),c!==d?(g=B(),g!==d?(g=ha(),g!==d?b=e={type:"interval-period",period:e.value,precision:c,secondary:null}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=
d)):(f=b,b=d),b===d&&(b=f,e=I(),e!==d&&(e=tb(e)),b=e,b===d&&(b=f,e=Ha(),e!==d?(c=B(),c!==d?(c=ga(),c!==d?(c=B(),c!==d?(c=w(),c!==d?(g=B(),g!==d?(g=Aa(),g!==d?(e=B(),e!==d?(e=l(),e!==d?(g=B(),g!==d?(g=ha(),g!==d?b=e=ub(c,e):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d),b===d&&(b=f,e=Ha(),e!==d?(c=B(),c!==d?(c=ga(),c!==d?(c=B(),c!==d?(c=l(),c!==d?(g=B(),g!==d?(g=ha(),g!==d?b=e={type:"interval-period",period:"second",precision:c,
secondary:null}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d)):(f=b,b=d),b===d&&(b=f,e=Ha(),e!==d&&(e={type:"interval-period",period:"second",precision:null,secondary:null}),b=e)))));return b}function I(){var a;a=f;a=xc();a!==d&&(a={type:"string",value:"day"});a===d&&(a=f,a=yc(),a!==d&&(a={type:"string",value:"hour"}),a===d&&(a=f,a=zc(),a!==d&&(a={type:"string",value:"minute"}),a===d&&(a=f,a=wc(),a!==d&&(a={type:"string",value:"month"}),a===d&&(a=f,a=vc(),a!==d&&(a={type:"string",
value:"year"})))));return a}function l(){var a;a=W();a!==d&&(a=parseFloat(a));return a}function w(){var a;a=W();a!==d&&(a=parseFloat(a));return a}function L(){var a;a=M();a===d&&(a=ba());return a}function M(){var b,e,c;b=f;39===a.charCodeAt(f)?(e=vb,f++):(e=d,0===z&&n(wb));e===d&&(a.substr(f,2)===xb?(e=xb,f+=2):(e=d,0===z&&n(Xd)));if(e!==d){e=[];c=f;a.substr(f,2)===Ea?(c=Ea,f+=2):(c=d,0===z&&n(yb));c!==d&&(c="'");c===d&&(zb.test(a.charAt(f))?(c=a.charAt(f),f++):(c=d,0===z&&n(Ab)));for(;c!==d;)e.push(c),
c=f,a.substr(f,2)===Ea?(c=Ea,f+=2):(c=d,0===z&&n(yb)),c!==d&&(c="'"),c===d&&(zb.test(a.charAt(f))?(c=a.charAt(f),f++):(c=d,0===z&&n(Ab)));e!==d?(39===a.charCodeAt(f)?(c=vb,f++):(c=d,0===z&&n(wb)),c!==d?b=e={type:"string",value:e.join("")}:(f=b,b=d)):(f=b,b=d)}else f=b,b=d;return b}function R(){var a,b,c;a=f;b=$a();b!==d?(b=B(),b!==d?(b=E(),b!==d?(c=B(),c!==d?(c=ab(),c!==d?(c=B(),c!==d?(c=E(),c!==d?a=b={type:"when_clause",operand:b,value:c}:(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=
a,a=d)):(f=a,a=d);return a}function ca(){var a,b,c;a=f;b=$a();b!==d?(b=B(),b!==d?(b=E(),b!==d?(c=B(),c!==d?(c=ab(),c!==d?(c=B(),c!==d?(c=E(),c!==d?a=b={type:"when_clause",operand:b,value:c}:(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function na(){var b,c;b=f;var e,g;c=f;a.substr(f,4).toLowerCase()===Yd?(e=a.substr(f,4),f+=4):(e=d,0===z&&n(Zd));e!==d?(e=f,z++,g=t(),z--,g===d?e=void 0:(f=e,e=d),e!==d?c="ELSE":(f=c,c=d)):(f=c,c=d);c!==d?(c=B(),c!==d?(c=E(),c!==
d?b={type:"else_clause",value:c}:(f=b,b=d)):(f=b,b=d)):(f=b,b=d);return b}function oa(){var b,c,e;b=W();b===d&&(b=f,45===a.charCodeAt(f)?(c=dc,f++):(c=d,0===z&&n(ec)),c===d&&(43===a.charCodeAt(f)?(c=bc,f++):(c=d,0===z&&n(cc))),c!==d?(e=W(),e!==d?b=c=c[0]+e:(f=b,b=d)):(f=b,b=d));return b}function N(){var b,c;b=f;46===a.charCodeAt(f)?(c=$d,f++):(c=d,0===z&&n(ae));c!==d?(c=W(),c===d&&(c=null),c!==d?b="."+(null!=c?c:""):(f=b,b=d)):(f=b,b=d);return b}function Z(){var b,c,e;c=b=f;be.test(a.charAt(f))?(e=
a.charAt(f),f++):(e=d,0===z&&n(ce));e!==d?(de.test(a.charAt(f))?(e=a.charAt(f),f++):(e=d,0===z&&n(ee)),e===d&&(e=null),e!==d?c="e"+(null===e?"":e):(f=c,c=d)):(f=c,c=d);c!==d?(e=W(),e!==d?b=c+e:(f=b,b=d)):(f=b,b=d);return b}function W(){var a,b;a=[];b=aa();if(b!==d)for(;b!==d;)a.push(b),b=aa();else a=d;a!==d&&(a=a.join(""));return a}function aa(){var b;fe.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===z&&n(ge));return b}function Y(){var b,c,e;b=f;a.substr(f,2).toLowerCase()===he?(c=a.substr(f,2),f+=
2):(c=d,0===z&&n(ie));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="IN":(f=b,b=d)):(f=b,b=d);return b}function V(){var b,c,e;b=f;a.substr(f,2).toLowerCase()===je?(c=a.substr(f,2),f+=2):(c=d,0===z&&n(ke));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="IS":(f=b,b=d)):(f=b,b=d);return b}function ua(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===le?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(me));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="LIKE":(f=b,b=d)):(f=b,b=d);return b}
function ka(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===ne?(c=a.substr(f,3),f+=3):(c=d,0===z&&n(oe));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="NOT":(f=b,b=d)):(f=b,b=d);return b}function fa(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===pe?(c=a.substr(f,3),f+=3):(c=d,0===z&&n(qe));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="AND":(f=b,b=d)):(f=b,b=d);return b}function la(){var b,c,e;b=f;a.substr(f,2).toLowerCase()===re?(c=a.substr(f,2),f+=2):(c=d,0===z&&n(se));c!==
d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="OR":(f=b,b=d)):(f=b,b=d);return b}function ma(){var b,c,e;b=f;a.substr(f,7).toLowerCase()===te?(c=a.substr(f,7),f+=7):(c=d,0===z&&n(ue));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="BETWEEN":(f=b,b=d)):(f=b,b=d);return b}function Fa(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===ve?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(we));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="FROM":(f=b,b=d)):(f=b,b=d);return b}function Ga(){var b,
c,e;b=f;a.substr(f,4).toLowerCase()===xe?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(ye));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="TRIM":(f=b,b=d)):(f=b,b=d);return b}function uc(){var b,c,e;b=f;a.substr(f,8).toLowerCase()===ze?(c=a.substr(f,8),f+=8):(c=d,0===z&&n(Ae));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="INTERVAL":(f=b,b=d)):(f=b,b=d);return b}function vc(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===Be?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(Ce));c!==d?(c=f,z++,e=t(),
z--,e===d?c=void 0:(f=c,c=d),c!==d?b="YEAR":(f=b,b=d)):(f=b,b=d);return b}function wc(){var b,c,e;b=f;a.substr(f,5).toLowerCase()===De?(c=a.substr(f,5),f+=5):(c=d,0===z&&n(Ee));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="MONTH":(f=b,b=d)):(f=b,b=d);return b}function xc(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===Fe?(c=a.substr(f,3),f+=3):(c=d,0===z&&n(Ge));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="DAY":(f=b,b=d)):(f=b,b=d);return b}function yc(){var b,c,e;b=f;a.substr(f,
4).toLowerCase()===He?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(Ie));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="HOUR":(f=b,b=d)):(f=b,b=d);return b}function zc(){var b,c,e;b=f;a.substr(f,6).toLowerCase()===Je?(c=a.substr(f,6),f+=6):(c=d,0===z&&n(Ke));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="MINUTE":(f=b,b=d)):(f=b,b=d);return b}function Ha(){var b,c,e;b=f;a.substr(f,6).toLowerCase()===Le?(c=a.substr(f,6),f+=6):(c=d,0===z&&n(Me));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:
(f=c,c=d),c!==d?b="SECOND":(f=b,b=d)):(f=b,b=d);return b}function Eb(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===Ne?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(Oe));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="CASE":(f=b,b=d)):(f=b,b=d);return b}function Fb(){var b,c,e;b=f;a.substr(f,3).toLowerCase()===Pe?(c=a.substr(f,3),f+=3):(c=d,0===z&&n(Qe));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="END":(f=b,b=d)):(f=b,b=d);return b}function $a(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===
Re?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(Se));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="WHEN":(f=b,b=d)):(f=b,b=d);return b}function ab(){var b,c,e;b=f;a.substr(f,4).toLowerCase()===Te?(c=a.substr(f,4),f+=4):(c=d,0===z&&n(Ue));c!==d?(c=f,z++,e=t(),z--,e===d?c=void 0:(f=c,c=d),c!==d?b="THEN":(f=b,b=d)):(f=b,b=d);return b}function Aa(){var b;44===a.charCodeAt(f)?(b=Ve,f++):(b=d,0===z&&n(We));return b}function ga(){var b;40===a.charCodeAt(f)?(b=Xe,f++):(b=d,0===z&&n(Ye));return b}function ha(){var b;
41===a.charCodeAt(f)?(b=Ze,f++):(b=d,0===z&&n($e));return b}function B(){var a,b;a=[];for(b=Bb();b!==d;)a.push(b),b=Bb();return a}function Bb(){var b;af.test(a.charAt(f))?(b=a.charAt(f),f++):(b=d,0===z&&n(bf));return b}function db(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function Ba(a,b){for(var c=0;c<b.length;c++)a=db(b[c][1],a,b[c][3]);return a}v=void 0!==v?v:{};var d={},Cb={start:u},Db=u,$c="!",ad=q("!",!1),bb="\x3d",cb=q("\x3d",!1),eb="\x3e\x3d",
dd=q("\x3e\x3d",!1),ed="\x3e",fd=q("\x3e",!1),fb="\x3c\x3d",gd=q("\x3c\x3d",!1),gb="\x3c\x3e",hd=q("\x3c\x3e",!1),id="\x3c",jd=q("\x3c",!1),hb="!\x3d",kd=q("!\x3d",!1),bc="+",cc=q("+",!1),dc="-",ec=q("-",!1),ld="*",md=q("*",!1),nd="/",od=q("/",!1),Hd=/^[A-Za-z_\x80-\uFFFF]/,Id=b([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Jd=/^[A-Za-z0-9_]/,Kd=b([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ld=/^[A-Za-z0-9_.\x80-\uFFFF]/,Md=b([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),
Nd="@",Od=q("@",!1),tb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},ub=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},vb="'",wb=q("'",!1),xb="N'",Xd=q("N'",!1),Ea="''",yb=q("''",!1),zb=/^[^']/,Ab=b(["'"],!0,!1),$d=".",ae=q(".",!1),fe=/^[0-9]/,ge=b([["0","9"]],!1,!1),be=/^[eE]/,ce=b(["e","E"],!1,!1),de=/^[+\-]/,ee=b(["+","-"],!1,!1),td="null",ud=q("NULL",!0),pd="true",qd=q("TRUE",!0),rd="false",sd=q("FALSE",!0),he="in",
ie=q("IN",!0),je="is",ke=q("IS",!0),le="like",me=q("LIKE",!0),bd="escape",cd=q("ESCAPE",!0),ne="not",oe=q("NOT",!0),pe="and",qe=q("AND",!0),re="or",se=q("OR",!0),te="between",ue=q("BETWEEN",!0),ve="from",we=q("FROM",!0),Dd="for",Ed=q("FOR",!0),Bd="substring",Cd=q("SUBSTRING",!0),zd="extract",Ad=q("EXTRACT",!0),xe="trim",ye=q("TRIM",!0),Fd="position",Gd=q("POSITION",!0),xd="timestamp",yd=q("TIMESTAMP",!0),vd="date",wd=q("DATE",!0),Pd="leading",Qd=q("LEADING",!0),Rd="trailing",Sd=q("TRAILING",!0),Td=
"both",Ud=q("BOTH",!0),Vd="to",Wd=q("TO",!0),ze="interval",Ae=q("INTERVAL",!0),Be="year",Ce=q("YEAR",!0),De="month",Ee=q("MONTH",!0),Fe="day",Ge=q("DAY",!0),He="hour",Ie=q("HOUR",!0),Je="minute",Ke=q("MINUTE",!0),Le="second",Me=q("SECOND",!0),Ne="case",Oe=q("CASE",!0),Pe="end",Qe=q("END",!0),Re="when",Se=q("WHEN",!0),Te="then",Ue=q("THEN",!0),Yd="else",Zd=q("ELSE",!0),Ve=",",We=q(",",!1),Xe="(",Ye=q("(",!1),Ze=")",$e=q(")",!1),af=/^[ \t\n\r]/,bf=b([" ","\t","\n","\r"],!1,!1),Sc="`",Tc=q("`",!1),Uc=
/^[^`]/,Vc=b(["`"],!0,!1),f=0,Ia=[{line:1,column:1}],da=0,Qa=[],z=0,za;if("startRule"in v){if(!(v.startRule in Cb))throw Error("Can't start parsing from rule \""+v.startRule+'".');Db=Cb[v.startRule]}za=Db();if(za!==d&&f===a.length)return za;za!==d&&f<a.length&&n({type:"end"});throw function(a,b,c){return new C(C.buildMessage(a,b),a,b,c)}(Qa,da<a.length?a.charAt(da):null,da<a.length?k(da,da+1):k(da,da));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(C,a,v,q,b,c,k,n,u){function y(a,b){var c;if(!b)return null;if("x"in b){var g={x:0,y:0};a=a(b.x,b.y,D);g.x=a[0];g.y=a[1];null!=b.z&&(g.z=b.z);null!=b.m&&(g.m=b.m);return g}if("xmin"in b)return g={xmin:0,ymin:0,xmax:0,ymax:0},c=a(b.xmin,b.ymin,D),g.xmin=c[0],g.ymin=c[1],a=a(b.xmax,b.ymax,D),g.xmax=a[0],g.ymax=a[1],b.hasZ&&(g.zmin=b.zmin,g.zmax=b.zmax,g.hasZ=!0),b.hasM&&(g.mmin=b.mmin,g.mmax=b.mmax,g.hasM=!0),g;if("rings"in b)return{rings:E(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:E(b.paths,
a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:x(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function E(a,b){for(var c=[],g=0;g<a.length;g++)c.push(x(a[g],b));return c}function x(a,b){for(var c=[],g=0;g<a.length;g++){var h=a[g],m=b(h[0],h[1],[0,0]);c.push(m);2<h.length&&m.push(h[2]);3<h.length&&m.push(h[3])}return c}function F(a,b){return!n.isValid(a)||!n.isValid(b)||n.equals(a,b)||u.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var D=[0,0];a.doesBrowserSupportProjection=
function(a,b){return F(a,b)?k.isSupported():!0};a.checkProjectionSupport=function(a,c){return q(this,void 0,void 0,function(){var e,g,h;return v(this,function(m){if(!c)return[2];if(Array.isArray(a)){e=0;for(g=a;e<g.length;e++)if(h=g[e],F(h.geometry&&h.geometry.spatialReference,c)){if(k.isSupported())return[2,k.load()];throw new b("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c});}return[2]}if(!F(a,c))return[2];if(k.isSupported())return[2,k.load()];
throw new b("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c});})})};var H=y.bind(null,u.lngLatToXY),G=y.bind(null,u.xyToLngLat);a.project=function(a,b,c){if(!a)return a;c||(c=b,b=a.spatialReference);return n.isValid(b)&&n.isValid(c)&&!n.equals(b,c)?u.canProject(b,c)?n.isWebMercator(c)?H(a):G(a):k.projectMany([a],b,c,null,!0)[0]:a};var A=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=
function(a,b,g){return q(this,void 0,void 0,function(){var e,h=this;return v(this,function(m){a&&a.length&&b&&g&&!n.equals(b,g)||c.resolve(a);e={geometries:a,inSpatialReference:b,outSpatialReference:g,resolve:null};this._jobs.push(e);return[2,c.create(function(a){e.resolve=a;null===h._timer&&(h._timer=setTimeout(h._process,10))},function(){var a=h._jobs.indexOf(e);-1<a&&h._jobs.splice(a,1)})]})})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=
a.inSpatialReference,h=a.outSpatialReference,a=a.resolve;u.canProject(c,h)?n.isWebMercator(h)?a(b.map(H)):a(b.map(G)):a(k.projectMany(b,c,h,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return a}());a.projectMany=function(a,b,c){return q(this,void 0,void 0,function(){return v(this,function(e){return[2,A.push(a,b,c)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),
function(C,a,v,q,b,c){function k(a,k,q,y,v){void 0===y&&(y=null);void 0===v&&(v=!1);if(null===y){var A=c.cacheKey(k,q);void 0!==E[A]?y=E[A]:(y=n(k,q,null),null===y&&(y=new c),E[A]=y)}return u._project(a,k,q instanceof b||!1===v?q:new b(q),y,v)}function n(a,b,k){void 0===k&&(k=null);a=u._getTransformation(a,b,k);return null!==a?c.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var u=null;a.isLoaded=function(){return!!u&&q.isLoaded()};a.isSupported=function(){return q.isSupported()};
var y=null;a.load=function(){return y?y:y=v.create(function(a,b){var c=q.load();C(["./geometryEngine"],function(k){u=k;c.then(function(){u._enableProjection(q);a()},function(a){b(a)})})})};a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:k(a,a[0].spatialReference,b,c):k([a],a.spatialReference,b,c)[0]};var E={};a.projectMany=k;a.getTransformation=n;a.getTransformations=function(a,b,k){void 0===k&&(k=null);a=u._getTransformationBySuitability(a,b,k);if(null!==
a){b=[];for(k=0;k<a.length;k++)b.push(c.fromGE(a[k]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(C,a,v,q,b){function c(b){function c(a,b,c){a[b]=c(a[b])}a._pe=b;x.init();F.init();D.init();H.init();G.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}v(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var k=
0,e=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];k<e.length;k++)b=e[k],c(b.prototype,"getName",function(a){return function(){return a.call(this,Array(x.PE_NAME_MAX))}});k=0;for(e=[a._pe.PeGeogtran,a._pe.PeProjcs];k<e.length;k++)b=e[k],c(b.prototype,"getParameters",function(b){return function(){for(var c=Array(x.PE_PARM_MAX),e=b.call(this),g=0;g<c.length;g++){var h=a._pe.getValue(e,"*");c[g]=h?a._pe.wrapPointer(h,
a._pe.PeParameter):null;e+=Int32Array.BYTES_PER_ELEMENT}return c}});c(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],e=a.call(this);y(c,b,e);return c}});c(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var e=null,g=b.call(this);if(!a._pe.compare(g,a._pe.NULL)){var e=[g],h=this.getSteps();if(1<h)for(var g=a._pe.getPointer(g),m=1;m<h;m++)e.push(a._pe.wrapPointer(g+
c*m,a._pe.PeGTlistExtendedGTs))}return e}});var g=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var e=null,h=b.call(this);if(!a._pe.compare(h,a._pe.NULL)){var e=[h],p=h.getNump();if(1<p)for(var h=a._pe.getPointer(h),k=1;k<p;k++)e.push(a._pe.wrapPointer(h+g*k,a._pe.PeHorizon))}c.set(b,e);return e}};c(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);c(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=
function(b){void 0===b&&(b=x.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),e=a._pe.ensureInt8(Array(x.PE_BUFFER_MAX));return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,e))}}function k(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function n(b,c){var h=[];c=Array(c);for(var e=0;e<b;e++)h.push(a._pe.ensureInt8(c));return h}function u(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):
b=a;return b}function y(b,c,k,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)b[e]=a._pe.getValue(k+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var g=0===b.length;for(e=0;e<c;e++)g&&(b[e]=Array(2)),b[e][0]=a._pe.getValue(k,"double"),b[e][1]=a._pe.getValue(k+Float64Array.BYTES_PER_ELEMENT,"double"),k+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var E;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!q("esri-wasm")};a.load=function(){return E?
E:E=b.create(function(a,b){C(["./support/pe-wasm"],function(h){h({locateFile:function(a){return C.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){c(b);a()})})})};(function(b){function c(b,c,e){a._pe.ensureCache.prepare();var g=u(e),h=e===g,g=a._pe.ensureFloat64(g);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),c,g))&&y(e,c,g,h);return b}function k(a,b,c){return e(a,b,c,0)}function e(b,c,e,h){a._pe.ensureCache.prepare();var g=u(e),m=e===g,g=a._pe.ensureFloat64(g);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),
c,g,h))&&y(e,c,g,m);return b}b.geogToProj=c;b.projGeog=function(a,b,e,h){switch(h){case x.PE_TRANSFORM_P_TO_G:return k(a,b,e);case x.PE_TRANSFORM_G_TO_P:return c(a,b,e)}return 0};b.projToGeog=k;b.projToGeogCenter=e})(a.PeCSTransformations||(a.PeCSTransformations={}));var x;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;
b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;
b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(x=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var g=null,h=e[b];h||(h={},e[b]=h);h.hasOwnProperty(String(c))?g=h[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,
c),a._pe.compare(b,a._pe.NULL)||(g=b,h[c]=g));return g=k(g)}function k(b){if(b){var c=b.getType();switch(c){case x.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case x.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case x.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&x.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var e={},g={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(x.PE_TYPE_COORDSYS,
a)};b.factoryByType=c;b.fromString=function(b,c){var e=null,h=g[b];h||(h={},g[b]=h);h.hasOwnProperty(c)?e=h[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(e=b,h[c]=e));return e=k(e)};b.geogcs=function(a){return c(x.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(x.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(x.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(x.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory=
{}));a.PeGCSExtent=null;var F;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,e,g,h,m,k){var p=null,n=new a._pe.PeInteger(k);try{var t=a._pe.PeGTlistExtended.prototype.getGTlist(b,e,g,h,m,n);if(k=n.val)if(p=[t],1<k){var r=a._pe.getPointer(t);for(b=1;b<k;b++)p.push(a._pe.wrapPointer(r+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(n)}return p}})(F=a.PeGTlistExtended||
(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var e=b[c];k(e);e.getEntries().forEach(function(a){k(a);a=a.getGeogtran();k(a);a.getParameters().forEach(k);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){k(a);var b=a.getDatum();k(b);k(b.getSpheroid());k(a.getPrimem());k(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,e,g,
k){a._pe.ensureCache.prepare();var h=u(e),p=e===h,h=a._pe.ensureFloat64(h),n=0;g&&(n=a._pe.ensureFloat64(g));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,h,n,k))&&y(e,c,h,p);return b}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(b){function c(b,c,h,m,k,r){a._pe.ensureCache.prepare();var e,g;switch(b){case "dd":e=a._pe._pe_geog_to_dd;g=x.PE_DD_MAX;break;case "ddm":e=a._pe._pe_geog_to_ddm;g=x.PE_DDM_MAX;break;case "dms":e=a._pe._pe_geog_to_dms,g=x.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));
c=u(m);c=a._pe.ensureFloat64(c);g=n(h,g);m=a._pe.ensureInt32(g);if(k=e(b,h,c,k,m))for(e=0;e<h;e++)r[e]=a._pe.UTF8ToString(g[e]);return k}function k(b,c,h,m,k){a._pe.ensureCache.prepare();var e;switch(b){case "dd":e=a._pe._pe_dd_to_geog;break;case "ddm":e=a._pe._pe_ddm_to_geog;break;case "dms":e=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=m.map(function(b){return a._pe.ensureString(b)});m=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*h));(e=e(b,h,m,c))&&y(k,h,c);return e}b.geog_to_dms=
function(a,b,h,m,k){return c("dms",a,b,h,m,k)};b.dms_to_geog=function(a,b,c,h){return k("dms",a,b,c,h)};b.geog_to_ddm=function(a,b,h,m,k){return c("ddm",a,b,h,m,k)};b.ddm_to_geog=function(a,b,c,h){return k("ddm",a,b,c,h)};b.geog_to_dd=function(a,b,h,k,n){return c("dd",a,b,h,k,n)};b.dd_to_geog=function(a,b,c,h){return k("dd",a,b,c,h)}})(a.PeNotationDms||(a.PeNotationDms={}));var D;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=
a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,e,g,k,m,t){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=u(e);e=a._pe.ensureFloat64(b);b=n(c,x.PE_MGRS_MAX);var p=a._pe.ensureInt32(b);if(g=a._pe._pe_geog_to_mgrs_extended(h,
c,e,g,k,m,p))for(k=0;k<c;k++)t[k]=a._pe.UTF8ToString(b[k]);return g};b.mgrs_to_geog_extended=function(b,c,e,g,k){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(g=a._pe._pe_mgrs_to_geog_extended(h,c,e,g,b))&&y(k,c,b);return g}})(D=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,e,g,k,m,t){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));
b=u(e);e=a._pe.ensureFloat64(b);b=n(c,x.PE_MGRS_MAX);var p=a._pe.ensureInt32(b);if(g=a._pe._pe_geog_to_usng(h,c,e,g,k,m,p))for(k=0;k<c;k++)t[k]=a._pe.UTF8ToString(b[k]);return g};b.usng_to_geog=function(b,c,e,g){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(h=a._pe._pe_usng_to_geog(h,c,e,b))&&y(g,c,b);return h}})(a.PeNotationUsng||(a.PeNotationUsng={}));var H;(function(b){b.init=
function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,c,e,g,k){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=u(e);e=a._pe.ensureFloat64(b);b=n(c,x.PE_UTM_MAX);var p=a._pe.ensureInt32(b);if(g=a._pe._pe_geog_to_utm(h,c,e,g,p))for(h=0;h<c;h++)k[h]=a._pe.UTF8ToString(b[h]);return g};b.utm_to_geog=
function(b,c,e,g,k){a._pe.ensureCache.prepare();var h=0;b&&(h=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(g=a._pe._pe_utm_to_geog(h,c,e,g,b))&&y(k,c,b);return g}})(H=a.PeNotationUtm||(a.PeNotationUtm={}));var G;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=
a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(h,e){void 0===e&&(e=b.PE_PCSINFO_OPTION_DOMAIN);var g,k;c.has(h)&&(k=c.get(h),k[e]&&(g=k[e]));g||(g=a._pe.PePCSInfo.prototype.generate(h,e),k||(k=[],c.set(h,k)),k[e]=g);return g}})(G=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=c})},"esri/geometry/support/GeographicTransformation":function(){define(["require",
"exports","./GeographicTransformationStep"],function(C,a,v){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var b=0;for(a=a.steps;b<a.length;b++){var k=a[b];k instanceof v?this.steps.push(k):this.steps.push(new v({wkid:k.wkid,wkt:k.wkt,isInverse:k.isInverse}))}}}a.cacheKey=function(a,c){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==c.wkid&&null!==c.wkid?
c.wkid.toString():"-1",void 0!==c.wkt&&null!==c.wkt?c.wkt.toString():""].join()};a.fromGE=function(b){var c=new a,k="",n=0;for(b=b.steps;n<b.length;n++){var q=v.fromGE(b[n]);c.steps.push(q);k+=q.uid.toString()+","}c._cached_projection={};c._gtlistentry=null;c._chain=k;return c};a.prototype.getInverse=function(){var b=new a;b.steps=[];for(var c=this.steps.length-1;0<=c;c--)b.steps.push(this.steps[c].getInverse());return b};a.prototype.getGTListEntry=function(){for(var a="",c=0,k=this.steps;c<k.length;c++)a+=
k[c].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(b,c,k){this._cached_projection[a.cacheKey(b,c)]=k};a.prototype.getCachedGeTransformation=function(b,c){for(var k="",n=0,q=this.steps;n<q.length;n++)k+=q[n].uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);b=this._cached_projection[a.cacheKey(b,c)];return void 0===b?null:b};return a}()})},
"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(C,a){var v=0;return function(){function a(a){void 0===a&&(a=null);this.uid=v++;a?(this._wkt=void 0!==a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(b){var c=new a;c._wkt=b.wkt;c._wkid=b.wkid;c._isInverse=b.isInverse;return c};Object.defineProperty(a.prototype,"wkt",
{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=a;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=v++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var b=new a;b._wkt=this.wkt;b._wkid=this._wkid;
b._isInverse=!this.isInverse;return b};return a}()})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(C,a){Object.defineProperty(a,"__esModule",{value:!0});a.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,
supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/iteratorUtils ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(C,a,v,q,b,c,k,n,u,y,E,x,F,D,H,G){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=c.featureAdapter}Object.defineProperty(a.prototype,"size",{get:function(){return this.items.length},
enumerable:!0,configurable:!0});a.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(y.isValid(a.outSR)&&!y.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=G.cleanFromGeometryEngine(v({spatialReference:a.outSR},D.project(this.queryGeometry,this.queryGeometry.spatialReference,
a.outSR))):b.queryGeometry=G.cleanFromGeometryEngine(v({spatialReference:a.outSR},this.queryGeometry)));return b};a.prototype.executeAttributesQuery=function(b){var c=F.getWhereClause(b.where,this.fieldsIndex);if(!c)return n.resolve(this);if(c.isStandardized){for(var e=0,g=[],h=0,k=this.items;h<k.length;h++){var t=k[h];c.testFeature(t,this.featureAdapter)&&(g[e++]=t)}c=new a(g,this.queryGeometry,this);c.definitionExpression=b.where;return n.resolve(c)}return n.reject(new TypeError("Where clause is not standardized"))};
a.prototype.executeObjectIdsQuery=function(b){if(!b.objectIds||!b.objectIds.length)return n.resolve(this);var h=c.createSetFromValues(b.objectIds),e=this.featureAdapter.getObjectId;return n.resolve(new a(this.items.filter(function(a){return h.has(e(a))}),this.queryGeometry,this))};a.prototype.executeTimeQuery=function(b){b=H.getTimeOperator(this.timeInfo,b.timeExtent,this.featureAdapter);if(!k.isSome(b))return n.resolve(this);b=this.items.filter(b);return n.resolve(new a(b,this.queryGeometry,this))};
a.prototype.project=function(c){return b(this,void 0,void 0,function(){var b,e,g,h=this;return q(this,function(k){switch(k.label){case 0:if(!c||y.equals(this.spatialReference,c))return[2,this];b=this.featureAdapter;return[4,D.projectMany(this.items.map(function(a){return G.getGeometry(h,b.getGeometry(a))}),this.spatialReference,c)];case 1:return e=k.sent(),g=e.map(function(a,c){return b.cloneWithGeometry(h.items[c],E.convertFromGeometry(a,h.hasZ,h.hasM))}),[2,new a(g,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:c,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};a.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,g=this.geometryType,h=this.hasM,k=this.hasZ,n=this.objectIdField,q=this.spatialReference,y=a.outFields,x=a.outSR,X=a.quantizationParameters,I=a.resultRecordCount,l=a.resultOffset,w=a.returnZ,F=a.returnM,v=!1;null!=I&&
null!=l&&(I=l+I,v=c.length>I,c=c.slice(l,Math.min(c.length,I)));return{exceededTransferLimit:v,features:this._createFeatures(a,c),fields:y&&y.map(function(a){return b.fieldsIndex.get(a)}),geometryType:g,hasM:h&&F,hasZ:k&&w,objectIdFieldName:n,spatialReference:G.cleanFromGeometryEngine(x?x:q),transform:X&&u.toQuantizationTransform(X)||null}};a.prototype._createFeatures=function(a,b){var c=new x.default(a,this.featureAdapter,this.fieldsIndex),g=a.orderByFields,h=a.quantizationParameters,k=a.returnGeometry,
n=a.returnCentroid,q=a.maxAllowableOffset,r=a.returnZ;a=a.returnM;var y=this.hasZ&&(void 0===r?!1:r),F=this.hasM&&(void 0===a?!1:a),r=[];a=0;if(b.length&&g&&g.length){var g=g[0].split(" "),I=g[0],l=this.fieldsIndex.get(I),w="DESC"===g[1];b.sort(function(a,b){a=c.getFieldValue(a,I,l);b=c.getFieldValue(b,I,l);if("number"===typeof a&&"number"===typeof b)return w?b-a:a-b;if("string"===typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(w?a>b:a<b)?-1:(w?a<b:a>b)?1:0})}if(k||n)if(h=
u.toQuantizationTransform(h),k&&!n)for(n=0;n<b.length;n++)k=b[n],r[a++]={attributes:c.getAttributes(k),geometry:G.getGeometry(this,this.featureAdapter.getGeometry(k),q,h,y,F)};else if(!k&&n)for(q=0;q<b.length;q++)k=b[q],r[a++]={attributes:c.getAttributes(k),centroid:G.transformCentroid(this,this.featureAdapter.getCentroid(k,this),h)};else for(n=0;n<b.length;n++)k=b[n],r[a++]={attributes:c.getAttributes(k),centroid:G.transformCentroid(this,this.featureAdapter.getCentroid(k,this),h),geometry:G.getGeometry(this,
this.featureAdapter.getGeometry(k),q,h,y,F)};else for(q=0;q<b.length;q++)k=b[q],(y=c.getAttributes(k))&&(r[a++]={attributes:y});return r};a.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,h=0;for(a=a.outStatistics;h<a.length;h++){var k=a[h];if("exceedslimit"===k.statisticType){c=null!=k.maxPointCount?k.maxPointCount:Number.POSITIVE_INFINITY;g=null!=k.maxRecordCount?k.maxRecordCount:Number.POSITIVE_INFINITY;
b=null!=k.maxVertexCount?k.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>c;else if(this.items.length>g)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,n=this.featureAdapter,b=this.items.reduce(function(a,b){b=n.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};
a.prototype._createStatisticsQueryResponse=function(a){var b=new x.default(a,this.featureAdapter,this.fieldsIndex),c=a.outStatistics,g=[],h=[],k=a.groupByFieldsForStatistics;a=a.having;for(var n=k&&k.length,k=n&&k[0],q=this.fieldsIndex.get(k),u=!q,y={},F={},I={},l={attributes:{}},w=0;w<c.length;w++){var v=c[w],E=v.outStatisticFieldName,A=v.statisticType,v="exceedslimit"!==A?v.onStatisticField:void 0,D=this.fieldsIndex.get(v),H=n&&(v===k||u)&&"count"===A;if(n){y[v]||(y[v]=this._calculateUniqueValues(b,
k,q));var C=y[v],G;for(G in C){var Z=C[G],W=Z.count,aa=Z.data,Y=Z.items;if(!a||b.validateItems(Y,a)){var Z=F[aa]||{attributes:{}},V=null;H?V=W:(W=this._calculateStatistics(Y,b,v,D),Y="var"===A?"variance":A,V=W[Y]);Z.attributes[E]=V;Z.attributes[u?"EXPR_1":k]=aa;F[aa]=Z}}}else I[v]||(I[v]=this._calculateStatistics(this.items,b,v,D)),W=I[v],Y="var"===A?"variance":A,l.attributes[E]=W[Y];h.push({name:E,alias:E,type:"esriFieldTypeDouble"})}if(n)for(var ua in F)g.push(F[ua]);else g.push(l);return{fields:h,
features:g}};a.prototype._calculateStatistics=function(a,b,c,g){for(var e=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY,h=null,n=null,q=null,u=null,r=[],y=0,l=0;l<a.length;l++){var w=b.getFieldValue(a[l],c,g);"string"===typeof w?y++:null==w||isNaN(w)||(h+=w,e=Math.min(e,w),k=Math.max(k,w),r.push(w),y++)}if(y){n=h/y;for(b=a=0;b<r.length;b++)w=r[b],a+=Math.pow(w-n,2);u=1<y?a/(y-1):0;q=Math.sqrt(u)}else k=e=null;return{avg:n,count:y,max:k,min:e,stddev:q,sum:h,variance:u}};a.prototype._calculateUniqueValues=
function(a,b,c){for(var e={},k=0,h=this.items;k<h.length;k++){var n=h[k],q=a.getFieldValue(n,b,c);if(null==q||"string"===typeof q&&""===q.trim())q=null;null==e[q]?e[q]={count:1,data:q,items:[n]}:(e[q].count++,e[q].items.push(n))}return e};return a}();a.default=C})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(C,a,v,q){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(a,b,n){this._fieldDataCache=
new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=n;this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var c=b=0;c<a.length;c++){var k=a[c],v=q.getExpressionFromFieldName(k),x=this.fieldsIndex.get(v),v=x?null:q.getWhereClause(v,n),x=x?x.name:q.getAliasFromFieldName(k)||"FIELD_EXP_"+b++;this._fieldDataCache.set(k,{alias:x,clause:v})}}}a.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);
return this._processAttributesForDistinctValues(a)};a.prototype.getFieldValue=function(a,b,n){var c=n?n.name:b,k=null;this._fieldDataCache.has(c)?k=this._fieldDataCache.get(c).clause:n||(k=q.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(c,{alias:c,clause:k}));return n?this.featureAdapter.getAttribute(a,c):k.calculateValue(a,this.featureAdapter)};a.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:q.getWhereClause(b,this.fieldsIndex)});
return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};a.prototype.validateItems=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:q.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};a.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var c={},q=0;q<b.length;q++){var y=this._fieldDataCache.get(b[q]),
v=y.alias,y=y.clause;c[v]=y?y.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,v)}return c};a.prototype._processAttributesForDistinctValues=function(a){if(v.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,c=[];if(b)for(var q=0;q<b.length;q++){var y=this._fieldDataCache.get(b[q]).alias;c.push(a[y])}else for(y in a)c.push(a[y]);b=(b||["*"]).join(",")+"\x3d"+c.join(",");c=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++c);return 1<c?null:
a};return a}();a.default=C})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],function(C,a){function v(a,c,k,n,q){if(null!=n&&null!=q&&n===q)return function(b){return n>=a.getAttribute(b,c)&&n<=a.getAttribute(b,k)};if(null!=n&&null!=q)return function(b){var u=a.getAttribute(b,c);b=a.getAttribute(b,k);return!(u>q||b<n)};if(null!=n)return function(b){return!(a.getAttribute(b,k)<n)};if(null!=q)return function(b){return!(a.getAttribute(b,c)>q)}}function q(a,c,k,n){if(null!=
k&&null!=n&&k===n)return function(b){return a.getAttribute(b,c)===k};if(null!=k&&null!=n)return function(b){return a.getAttribute(b,c)>=k&&a.getAttribute(b,c)<=n};if(null!=k)return function(b){return a.getAttribute(b,c)>=k};if(null!=n)return function(b){return a.getAttribute(b,c)<=n}}Object.defineProperty(a,"__esModule",{value:!0});a.getTimeExtent=function(a,c){if(!a)return null;var b=c.featureAdapter,n=a.startTimeField,q=a.endTimeField,y=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;if(n&&
q)c.forEach(function(a){var c=b.getAttribute(a,n);a=b.getAttribute(a,q);null==c||isNaN(c)||(y=Math.min(y,c));null==a||isNaN(a)||(v=Math.max(v,a))});else{var x=n||q;c.forEach(function(a){a=b.getAttribute(a,x);null==a||isNaN(a)||(y=Math.min(y,a),v=Math.max(v,a))})}return{start:y,end:v}};a.getTimeOperator=function(a,c,k){if(!c||!a)return null;var b=a.startTimeField;a=a.endTimeField;if(!b&&!a)return null;var u=c.start;c=c.end;return null==u&&null==c?null:b&&a?v(k,b,a,u,c):q(k,b||a,u,c)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/jsonMap ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(C,a,v,q,b,c,k,n,u,y,E,x,F,D,H,G,A){function h(a,b,c,e,g){void 0===e&&(e=a.hasZ);void 0===g&&(g=a.hasM);var h=a.hasZ&&e,k=a.hasM&&g;return c?(a=D.quantizeOptimizedGeometry(t,b,a.hasZ,a.hasM,"esriGeometryPoint",c,e,g),D.convertToPoint(a,h,k)):D.convertToPoint(b,h,k)}function r(b,g,h){return q(this,void 0,void 0,function(){var k,m,l,p,n,q;return v(this,function(t){switch(t.label){case 0:if(!b)return[2,null];k=b.where;b.where=k=k&&k.trim();if(!k||/^1 *= *1$/.test(k)||g&&g===k)b.where=null;return b.geometry?
[4,e(b)]:[2,b];case 1:return m=t.sent(),b.distance=0,b.units=null,"esriSpatialRelEnvelopeIntersects"===b.spatialRel&&(l=b.geometry.spatialReference,m=u.getGeometryExtent(m),m.spatialReference=l),b.geometry=m,[4,G.checkProjectionSupport(m.spatialReference,h)];case 2:return t.sent(),[4,E.normalizeCentralMeridian(y.fromJSON(m))];case 3:p=t.sent()[0];if(c.isNone(p))throw a.QUERY_ENGINE_EMPTY_RESULT;n=p.toJSON();return[4,G.project(n,n.spatialReference,h)];case 4:q=t.sent();if(!q)throw a.QUERY_ENGINE_EMPTY_RESULT;
q.spatialReference=h;b.geometry=q;return[2,b]}})})}function e(a){return q(this,void 0,void 0,function(){var b,c,e,h,m,p,q,t,u,r;return v(this,function(l){switch(l.label){case 0:b=a.geometry;c=a.distance;e=a.units;if(null==c)return[2,k.resolve(b)];h=b.spatialReference;m=e&&g.fromJSON(e)||n.getUnitString(h);p=h&&(x.isGeographic(h)||x.isWebMercator(h));if(!p)return[3,1];t=b;return[3,3];case 1:return[4,G.checkProjectionSupport(h,x.WGS84).then(function(){return G.project(b,x.WGS84)})];case 2:t=l.sent(),
l.label=3;case 3:return q=t,[4,A.getGeodesicBufferOperator()];case 4:return u=l.sent(),r=u(q,c,m),[2,r?r.toJSON():null]}})})}Object.defineProperty(a,"__esModule",{value:!0});var g=new b.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});a.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var p=new H.default,m=new H.default,t=new H.default,U={esriGeometryPoint:D.convertToPoint,
esriGeometryPolyline:D.convertToPolyline,esriGeometryPolygon:D.convertToPolygon,esriGeometryMultipoint:D.convertToMultipoint};a.transformCentroid=h;a.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=F.getCentroidOptimizedGeometry(new H.default,b.geometry,a.hasZ,a.hasM));return h(a,b.centroid,c)};a.getGeometry=function(a,b,c,e,g,h){void 0===g&&(g=a.hasZ);void 0===h&&(h=a.hasM);var k=a.hasZ&&g,l=a.hasM&&h;b=b?"coords"in
b?b:b.geometry:null;if(!b)return null;if(c)return c=D.generalizeOptimizedGeometry(m,b,a.hasZ,a.hasM,a.geometryType,c,g,h),e&&(c=D.quantizeOptimizedGeometry(t,c,k,l,a.geometryType,e)),U[a.geometryType](c,k,l);if(e)return c=D.quantizeOptimizedGeometry(t,b,a.hasZ,a.hasM,a.geometryType,e,g,h),U[a.geometryType](c,k,l);D.removeZMValues(p,b,a.hasZ,a.hasM,g,h);return U[a.geometryType](p,k,l)};a.normalizeQuery=function(a,b,c){return q(this,void 0,void 0,function(){var e,g,h,k,m;return v(this,function(l){e=
a.outFields;g=a.orderByFields;h=a.groupByFieldsForStatistics;k=a.outStatistics;if(e)for(m=0;m<e.length;m++)e[m]=e[m].trim();if(g)for(m=0;m<g.length;m++)g[m]=g[m].trim();if(h)for(m=0;m<h.length;m++)h[m]=h[m].trim();if(k)for(m=0;m<k.length;m++)k[m].onStatisticField&&(k[m].onStatisticField=k[m].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,r(a,b,c)]})})};a.normalizeFilter=function(a,b,c){return q(this,void 0,void 0,function(){return v(this,function(e){return[2,
r(a,b,c)]})})};a.normalizeQueryLike=r;a.cleanFromGeometryEngine=function(a){return a&&ba in a?JSON.parse(JSON.stringify(a,ja)):a};var ba="_geVersion",ja=function(a,b){return a!==ba?b:void 0}})},"esri/layers/graphics/centroid":function(){define(["require","exports"],function(C,a){function v(a,c,k,n,q,y){y=q?y?4:3:y?3:2;var b=k,u=k+y,v=0,D=0,C=k=0,G=0,A=0;for(--n;A<n;A++,b+=y,u+=y){var h=c[b],r=c[b+1],e=c[b+2],g=c[u],p=c[u+1],m=c[u+2],t=h*p-g*r,C=C+t,v=v+(h+g)*t,D=D+(r+p)*t;q&&(t=h*m-g*e,k+=(e+m)*t,
G+=t);h<a[0]&&(a[0]=h);h>a[1]&&(a[1]=h);r<a[2]&&(a[2]=r);r>a[3]&&(a[3]=r);q&&(e<a[4]&&(a[4]=e),e>a[5]&&(a[5]=e))}0<C&&(C*=-1);0<G&&(G*=-1);if(!C)return null;a=[v,D,.5*C];q&&(a[3]=k,a[4]=.5*G);return a}function q(a,c,k,n,q){q=n?q?4:3:q?3:2;for(var b=c,u=c+q,v=0,F=0,D=0,C=0,G=0,A=k-1;G<A;G++,b+=q,u+=q){var h=a[b],r=a[b+1],e=a[b+2],g=a[u],p=a[u+1],m=a[u+2],t;if(n){t=g-h;var U=p-r,ba=m-e;t=Math.sqrt(t*t+U*U+ba*ba)}else t=g-h,U=p-r,t=Math.sqrt(t*t+U*U);t&&(v+=t,n?(h=[h+.5*(g-h),r+.5*(p-r),e+.5*(m-e)],
F+=t*h[0],D+=t*h[1],C+=t*h[2]):(h=[h+.5*(g-h),r+.5*(p-r)],F+=t*h[0],D+=t*h[1]))}return 0<v?n?[F/v,D/v,C/v]:[F/v,D/v]:0<k?n?[a[c],a[c+1],a[c+2]]:[a[c],a[c+1]]:null}Object.defineProperty(a,"__esModule",{value:!0});a.getCentroidOptimizedGeometry=function(a,c,k,n){if(!c||!c.lengths.length)return null;a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);for(var b=a.coords,y=[],E=k?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],x=c.lengths,F=c.coords,D=k?n?4:3:n?3:2,C=0,G=0;G<x.length;G++){var A=x[G],h=v(E,F,C,A,k,n);h&&y.push(h);C+=A*D}y.sort(function(a,b){var c=a[2]-b[2];0===c&&k&&(c=a[4]-b[4]);return c});y.length&&(D=6*y[0][2],b[0]=y[0][0]/D,b[1]=y[0][1]/D,k&&(D=6*y[0][4],b[2]=0!==D?y[0][3]/D:0),b[0]<E[0]||b[0]>E[1]||b[1]<E[2]||b[1]>E[3]||k&&(b[2]<E[4]||b[2]>E[5]))&&
(b.length=0);if(!b.length)if(c=c.lengths[0]?q(F,0,x[0],k,n):null)b[0]=c[0],b[1]=c[1],k&&2<c.length&&(b[2]=c[2]);else return null;return a};a.lineCentroid=q})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(C,a,v,q,b,c,k,n,u,y,E,x,F,D,H){function G(){return c.create(function(a){return C(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(a,"__esModule",{value:!0});var A={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},h={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},r={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},e={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};a.importGeometryEngine=G;a.getGeodesicBufferOperator=function(){return G().then(function(a){return a.geodesicBuffer})};a.getSpatialQueryOperator=function(a,b,e){if(u.isPolygon(b)&&"esriGeometryPoint"===e.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a)){var g=x.convertFromPolygon(new F.default,b,!1,!1);return c.resolve(function(a){return E.polygonContainsPoint(g,!1,!1,a)})}if(u.isPolygon(b)&&"esriGeometryMultipoint"===e.geometryType){var h=
x.convertFromPolygon(new F.default,b,!1,!1);if("esriSpatialRelContains"===a)return c.resolve(function(a){return E.polygonContainsMultipoint(h,!1,!1,a,e.hasZ,e.hasM)})}if(u.isExtent(b)&&"esriGeometryPoint"===e.geometryType&&("esriSpatialRelIntersects"===a||"esriSpatialRelContains"===a))return c.resolve(function(a){return k.extentContainsPoint(b,H.getGeometry(e,a))});if(u.isExtent(b)&&"esriGeometryMultipoint"===e.geometryType&&"esriSpatialRelContains"===a)return c.resolve(function(a){return k.extentContainsMultipoint(b,
H.getGeometry(e,a))});if(u.isExtent(b)&&"esriSpatialRelIntersects"===a){var m=n.getExtentIntersector(e.geometryType);return c.resolve(function(a){return m(b,H.getGeometry(e,a))})}return G().then(function(c){var g=c[A[a]].bind(null,b);return function(a){return g(H.getGeometry(e,a))}})};a.checkSpatialQuerySupport=function(a,c,k){return q(this,void 0,void 0,function(){var g,m;return v(this,function(p){g=a.spatialRel;m=a.geometry;if(!m)return[2];if(!0!==h[g])throw new b("feature-store:unsupported-query",
"Unsupported query spatial relationship",{query:a});if(!y.isValid(m.spatialReference)||!y.isValid(k))return[2];if(!0!==r[u.getJsonType(m)])throw new b("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==e[c])throw new b("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,D.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};a.canQueryWithRBush=function(a){if(u.isExtent(a))return!0;if(u.isPolygon(a)){var b=
0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(C,a){function v(a,b,c,k,n){if(!a)return!1;b=b?c?4:3:c?3:2;c=a.coords;var q=!1,v=0,E=0;for(a=a.lengths;E<a.length;E++){for(var x=a[E],F=v,D=v,C=v+x*b;D<C;D+=b){F=D+b;F===C&&(F=v);var G=c[D],A=c[D+1],h=c[F],F=c[F+1];(A<
n&&F>=n||F<n&&A>=n)&&G+(n-A)/(F-A)*(h-G)<k&&(q=!q)}v+=x*b}return q}Object.defineProperty(a,"__esModule",{value:!0});a.polygonContainsPoint=function(a,b,c,k){return v(a,b,c,k.coords[0],k.coords[1])};a.polygonContainsMultipoint=function(a,b,c,k,n,u){n=n?u?4:3:u?3:2;u=k.coords;k=k.lengths;if(!k)return!1;for(var q=0,E=0;q<k.length;q++,E+=n)if(!v(a,b,c,u[E],u[E+1]))return!1;return!0};a.polygonContainsCoords=v})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],
function(C,a,v){Object.defineProperty(a,"__esModule",{value:!0});C=function(){function a(){this._deferreds=[];this._values=[]}a.prototype.push=function(a){var b=this;return v.create(function(c,n){b._deferreds.push({resolve:c,reject:n});b._values.push(a)})};a.prototype.unshift=function(a){var b=this;return v.create(function(c,n){b._deferreds.unshift({resolve:c,reject:n});b._values.unshift(a)})};Object.defineProperty(a.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,
configurable:!0});a.prototype.process=function(){if(0===this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};a.prototype.cancelAll=function(){for(var a=v.createAbortError(),c=0,k=this._deferreds;c<k.length;c++)k[c].reject(a);this._deferreds.length=0;this._values.length=0};return a}();a.PromiseQueue=C})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require","exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(C,
a,v,q,b){Object.defineProperty(a,"__esModule",{value:!0});a.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new q.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,k){a.centroid||(a.centroid=v.getCentroidOptimizedGeometry(new b.default,a.geometry,k.hasZ,k.hasM));return a.centroid}};
a.default=a.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/sources/geojson/geojson":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/valuesHelper ../../../../core/Error ../../OptimizedFeature ../../OptimizedGeometry".split(" "),function(C,a,v,q,b,c,k,n){function u(a){var b=[];a.forEach(function(a){return b.push(a)});return b}function y(a){var b,c,e,h;return v(this,function(g){switch(g.label){case 0:b=
a.type;switch(b){case "Feature":return[3,1];case "FeatureCollection":return[3,3]}return[3,7];case 1:return[4,a];case 2:return g.sent(),[3,7];case 3:c=0,e=a.features,g.label=4;case 4:return c<e.length?(h=e[c])?[4,h]:[3,6]:[3,7];case 5:g.sent(),g.label=6;case 6:return c++,[3,4];case 7:return[2]}})}function E(a){var c,e,h,k,n,q,r,u,x,l;return v(this,function(g){switch(g.label){case 0:if(!a)return[2,null];c=a.type;switch(c){case "Point":return[3,1];case "LineString":return[3,3];case "MultiPoint":return[3,
3];case "MultiLineString":return[3,5];case "Polygon":return[3,5];case "MultiPolygon":return[3,10]}return[3,17];case 1:return[4,a.coordinates];case 2:return g.sent(),[3,17];case 3:return[5,b(a.coordinates)];case 4:return g.sent(),[3,17];case 5:e=0,h=a.coordinates,g.label=6;case 6:if(!(e<h.length))return[3,9];k=h[e];return[5,b(k)];case 7:g.sent(),g.label=8;case 8:return e++,[3,6];case 9:return[3,17];case 10:n=0,q=a.coordinates,g.label=11;case 11:if(!(n<q.length))return[3,16];r=q[n];u=0;x=r;g.label=
12;case 12:if(!(u<x.length))return[3,15];l=x[u];return[5,b(l)];case 13:g.sent(),g.label=14;case 14:return u++,[3,12];case 15:return n++,[3,11];case 16:return[3,17];case 17:return[2]}})}function x(a,b){var c,e,g,h,q,u,x,y,l,w,A;void 0===b&&(b={});return v(this,function(m){switch(m.label){case 0:c=b.geometryType,e=b.ignoreIds,g=b.nextObjectId,h=void 0===g?1:g,m.label=1;case 1:q=a.next();u=q.value;if(x=q.done)return[2];y=u.geometry;l=u.properties;w=u.id;if(y&&r[y.type]!==c)return[3,1];A=new k.default(y?
H(new n.default,y,b):null,l);A.objectId=e||null==w?h++:w;return[4,A];case 2:return m.sent(),[3,1];case 3:return[2]}})}function F(a){for(var b=0,c=0;c<a.length;c++)var e=a[c],h=a[(c+1)%a.length],b=b+(e[0]*h[1]-h[0]*e[1]);return 0>=b}function D(a){var b=a[0],c=a[a.length-1];b[0]===c[0]&&b[1]===c[1]&&b[2]===c[2]||a.push(b);return a}function H(a,b,c){switch(b.type){case "LineString":return G(a,b.coordinates,c),a;case "MultiLineString":var e=0;for(b=b.coordinates;e<b.length;e++)G(a,b[e],c);return a;case "MultiPoint":return G(a,
b.coordinates,c),a;case "MultiPolygon":e=0;for(b=b.coordinates;e<b.length;e++){var g=b[e],k=a,n=c,p=D(g[0]);F(p)?G(k,p,n):A(k,p,n);for(k=1;k<g.length;k++){var n=a,p=c,q=D(g[k]);F(q)?A(n,q,p):G(n,q,p)}}return a;case "Point":return h(a,b.coordinates,c),a;case "Polygon":e=b.coordinates;b=D(e[0]);F(b)?G(a,b,c):A(a,b,c);for(b=1;b<e.length;b++)g=a,k=c,n=D(e[b]),F(n)?A(g,n,k):G(g,n,k);return a}}function G(a,b,c){for(var e=0;e<b.length;e++)h(a,b[e],c);a.lengths.push(b.length)}function A(a,b,c){for(var e=
b.length-1;0<=e;e--)h(a,b[e],c);a.lengths.push(b.length)}function h(a,b,c){var e=b[2];a.coords.push(b[0],b[1]);c.hasZ&&a.coords.push(e||0)}Object.defineProperty(a,"__esModule",{value:!0});var r={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};a.validateGeoJSON=function(a){if(!a)throw new c("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==
a.type&&"FeatureCollection"!==a.type)throw new c("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:a});if(a.crs){var b=a.crs;if("link"===b.type||!["crs84","4326"].some(function(a){return-1!==b.properties.name.toLowerCase().indexOf(a)}))throw new c("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:b});}};a.inferLayerProperties=function(a,b){void 0===b&&(b={});a=y(a);var c=[],e=new Set,g=new Set,h=!1,k=Number.NEGATIVE_INFINITY,n=!1,
q=void 0;b=b.geometryType;b=void 0===b?null:b;for(var v=!1;;){var l=a.next(),w=l.value;if(l.done)return{fields:c,geometryType:b,hasZ:h,maxObjectId:Math.max(0,k),objectIdFieldType:q,objectIdOnFeature:n,unknownFields:u(g)};var x=w.geometry,l=w.properties,w=w.id;if(x&&(b||(b=r[x.type]),r[x.type]!==b))continue;if(!h)a:for(h=E(x);;){var x=h.next(),A=x.value;if(x.done){h=!1;break a}if(2<A.length){h=!0;break a}}n||(n=null!=w)&&(q=typeof w);n&&"number"===q&&null!=w&&(k=Math.max(k,w));if(!v&&l){var v=!0,F;
for(F in l)if(!e.has(F))if(w=l[F],null==w)v=!1,g.add(F);else{a:switch(typeof w){case "string":w="esriFieldTypeString";break a;case "number":w="esriFieldTypeDouble";break a;default:w="unknown"}"unknown"===w?g.add(F):(g.delete(F),e.add(F),c.push({name:F,alias:F,type:w}))}}}};a.createOptimizedFeatures=function(a,b){a:for(a=x(y(a),b),b=[];;){var c=a.next(),e=c.value;if(c.done)break a;b.push(e)}return b}})},"esri/core/tsSupport/valuesHelper":function(){define([],function(){return function(C){var a="function"===
typeof Symbol&&C[Symbol.iterator],v=0;return a?a.call(C):{next:function(){C&&v>=C.length&&(C=void 0);return{value:C&&C[v++],done:!C}}}}})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/lang ../../../../symbols/support/defaultsJSON".split(" "),function(C,a,v,q,b,c){Object.defineProperty(a,"__esModule",{value:!0});a.createDrawingInfo=function(a){return{renderer:{type:"simple",
symbol:"esriGeometryPoint"===a||"esriGeometryMultipoint"===a?c.defaultPointSymbolJSON:"esriGeometryPolyline"===a?c.defaultPolylineSymbolJSON:c.defaultPolygonSymbolJSON}}};a.createDefaultAttributesFunction=function(a,b){if(q("csp-restrictions"))return function(){var c;return v((c={},c[b]=null,c),a)};try{var c="this."+b+" \x3d null;",k;for(k in a)c+="this."+k+" \x3d "+JSON.stringify(a[k])+";";var n=new Function(c);return function(){return new n}}catch(x){return function(){var c;return v((c={},c[b]=
null,c),a)}}};a.createDefaultTemplate=function(a){void 0===a&&(a={});return[{name:"New Feature",description:"",prototype:{attributes:b.clone(a)}}]}})},"esri/layers/graphics/sources/support/sourceUtils":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../support/fieldUtils @dojo/framework/shim/Promise".split(" "),function(C,a,v,q,b){function c(a){return new u(a)}function k(){return q(this,void 0,void 0,function(){return v(this,
function(a){switch(a.label){case 0:return x?[2,x]:[4,new Promise(function(a,b){C(["../../../../geometry/geometryEngine"],a,b)})];case 1:return x=a.sent(),[2,x]}})})}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){return function(){this.description=this.code=null}}(),u=function(){return function(a){this.error=new n;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=a}}();a.createFeatureEditErrorResult=c;var y=function(){return function(a){this.globalId=
null;this.success=!0;this.objectId=this.uniqueId=a}}();a.createFeatureEditSuccessResult=function(a){return new y(a)};var E=new Set;a.mixAttributes=function(a,k,n,q,v,h){void 0===v&&(v=!1);E.clear();for(var r in q){var e=a.get(r);if(e){var g=q[r],p;p=e;var m=g,t=m;"string"===typeof m&&b.isNumericField(p)?t=parseFloat(m):null!=m&&b.isStringField(p)&&"string"!==typeof m&&(t=String(m));p=b.sanitizeNullFieldValue(t);p!==g&&h&&h.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",
details:{field:e,originalValue:g,sanitizedValue:p}});E.add(e.name);if(e&&(v||e.editable)){if(g=b.validateFieldValue(e,p))return c(b.validationErrorToString(g,e,p));n[e.name]=p}}}for(a=0;a<k.length;a++)if(n=k[a],!E.has(n.name))return c('missing required field "'+n.name+'"');return null};var x;a.simplify=function(a,b){if(!a)return a;if("rings"in a||"paths"in a){if(!x)throw new TypeError("geometry engine not loaded");a.spatialReference||(a.spatialReference=b);return(a=x.simplify(a))?a.toJSON():null}return a};
a.loadGeometryEngine=k;a.loadGeometryEngineForSimplify=function(a){return q(this,void 0,void 0,function(){return v(this,function(b){switch(b.label){case 0:return"esriGeometryPolygon"!==a&&"esriGeometryPolyline"!==a?[3,2]:[4,k()];case 1:b.sent(),b.label=2;case 2:return[2]}})})}})},"*noref":1}});
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/Error ../../../../core/promiseUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../featureConversionUtils ../../data/FeatureStore ../../data/projectionSupport ../../data/QueryEngine ./geojson ../support/clientSideDefaults ../support/sourceUtils ../../../support/FieldsIndex ../../../support/fieldType ../../../support/fieldUtils".split(" "),function(C,
a,v,q,b,c,k,n,u,y,E,x,F,D,H,G,A,h,r,e){Object.defineProperty(a,"__esModule",{value:!0});var g={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,
supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};C=function(){function a(){this._featuresInfo=this._queryEngine=null}a.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy();this._queryEngine=this._featuresInfo=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null};a.prototype.load=function(a){return b(this,void 0,void 0,function(){var b,m,n,p,u,A,l,w,C,M,R,ca,
na,oa,N,Z,W,aa,Y,V,ua,ka,fa,la,ma,Fa,Ga;return v(this,function(t){switch(t.label){case 0:return b=[],[4,this._checkProjection(a.spatialReference)];case 1:return t.sent(),m=null,a.url?[4,c(a.url,{responseType:"json"})]:[3,4];case 2:return n=t.sent(),m=n.data,[4,H.validateGeoJSON(m)];case 3:t.sent(),t.label=4;case 4:p=H.inferLayerProperties(m,{geometryType:a.geometryType});u=a.fields||p.fields||[];A=null!=a.hasZ?a.hasZ:p.hasZ;l=p.geometryType;w=a.objectIdField||"OBJECTID";C=a.spatialReference||y.WGS84;
M=a.timeInfo;if(!l)throw new k("geojson-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");"string"===p.objectIdFieldType&&b.push({name:"geojson-layer:unsupported-id-type",message:"Feature ids are of type string and can't be honored."});u===p.fields&&0<p.unknownFields.length&&b.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:p.unknownFields}});
w&&(R=null,(ca=u.some(function(a){return a.name===w?(R=a,!0):!1}))?(R.type="esriFieldTypeOID",R.editable=!1,R.nullable=!1):u.unshift({alias:w,name:w,type:"esriFieldTypeOID",editable:!1,nullable:!1}));na=0;for(oa=u;na<oa.length;na++){N=oa[na];null==N.name&&(N.name=N.alias);null==N.alias&&(N.alias=N.name);if(!N.name)throw new k("geojson-layer:invalid-field-name","field name is missing",{field:N});N.name===w&&(N.type="esriFieldTypeOID");if(-1===r.kebabDict.jsonValues.indexOf(N.type))throw new k("geojson-layer:invalid-field-type",
'invalid type for field "'+N.name+'"',{field:N});}Z={};this._requiredFields=[];W=0;for(aa=u;W<aa.length;W++)N=aa[W],"esriFieldTypeOID"!==N.type&&"esriFieldTypeGlobalID"!==N.type&&(N.editable=null==N.editable?!0:!!N.editable,N.nullable=null==N.nullable?!0:!!N.nullable,Y=e.getFieldDefaultValue(N),N.nullable||void 0!==Y?Z[N.name]=Y:this._requiredFields.push(N));this._fieldsIndex=new h(u);M&&(M.startTimeField&&((V=this._fieldsIndex.get(M.startTimeField))?(M.startTimeField=V.name,V.type="esriFieldTypeDate"):
M.startTimeField=null),M.endTimeField&&((ua=this._fieldsIndex.get(M.endTimeField))?(M.endTimeField=ua.name,ua.type="esriFieldTypeDate"):M.endTimeField=null),M.trackIdField&&((ka=this._fieldsIndex.get(M.trackIdField))?M.trackIdField=ka.name:(M.trackIdField=null,b.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:M}}))),M.startTimeField||M.endTimeField||(b.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",
details:{timeInfo:M}}),M=null));fa={warnings:b,featureErrors:[],layerDefinition:q({},g,{drawingInfo:G.createDrawingInfo(l),templates:G.createDefaultTemplate(Z),extent:null,geometryType:l,objectIdField:w,fields:u,hasZ:!!A,timeInfo:M})};this._queryEngine=new D.default({fields:u,geometryType:l,hasM:!1,hasZ:A,objectIdField:w,spatialReference:C,timeInfo:M,featureStore:new x.default({geometryType:l,hasM:!1,hasZ:A})});this._createDefaultAttributes=G.createDefaultAttributesFunction(Z,w);this._featuresInfo=
{nextObjectId:p.maxObjectId+1,geometryType:l,hasZ:A,ignoreIds:"string"===p.objectIdFieldType};la=H.createOptimizedFeatures(m,this._featuresInfo);if(!y.equals(C,y.WGS84))for(ma=0,Fa=la;ma<Fa.length;ma++)Ga=Fa[ma],Ga.geometry&&(Ga.geometry=E.convertFromGeometry(F.project(E.convertToGeometry(Ga.geometry,l,A,!1),y.WGS84,C)));this._loadInitialFeatures(fa,la);return[2,fa]}})})};a.prototype.applyEdits=function(a){return b(this,void 0,void 0,function(){var b,c,e;return v(this,function(g){switch(g.label){case 0:return b=
this._queryEngine,c=b.spatialReference,e=b.geometryType,[4,n.all([A.loadGeometryEngineForSimplify(e),F.checkProjectionSupport(a.adds,c),F.checkProjectionSupport(a.updates,c)])];case 1:return g.sent(),[2,this._applyEdits(a)]}})})};a.prototype.queryFeatures=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return v(this,function(b){return[2,this._queryEngine.executeQuery(a,c.signal)]})})};a.prototype.queryFeatureCount=function(a,c){void 0===a&&(a={});void 0===
c&&(c={});return b(this,void 0,void 0,function(){return v(this,function(b){return[2,this._queryEngine.executeQueryForCount(a,c.signal)]})})};a.prototype.queryObjectIds=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return v(this,function(b){return[2,this._queryEngine.executeQueryForIds(a,c.signal)]})})};a.prototype.queryExtent=function(a,c){void 0===a&&(a={});void 0===c&&(c={});return b(this,void 0,void 0,function(){return v(this,function(b){return[2,this._queryEngine.executeQueryForExtent(a,
c.signal)]})})};a.prototype._loadInitialFeatures=function(a,b){for(var c=this._queryEngine.featureStore,e=[],g=0;g<b.length;g++){var h=b[g],k=this._createDefaultAttributes(),l=A.mixAttributes(this._fieldsIndex,this._requiredFields,k,h.attributes,!0,a.warnings);l?a.featureErrors.push(l):(this._assignObjectId(k,h.attributes,!0),h.attributes=k,e.push(h))}c.addMany(e);a.layerDefinition.extent=this._queryEngine.fullExtent;a.layerDefinition.timeInfo&&(b=this._queryEngine.timeExtent,a.layerDefinition.timeInfo.timeExtent=
[b.start,b.end]);return a};a.prototype._applyEdits=function(a){var b=a.adds,c=a.updates;a=a.deletes;var e={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};b&&b.length&&this._applyAddEdits(e,b);c&&c.length&&this._applyUpdateEdits(e,c);if(a&&a.length){for(b=0;b<a.length;b++)e.deleteResults.push(A.createFeatureEditSuccessResult(a[b]));this._queryEngine.featureStore.removeManyById(a)}return{fullExtent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:e}};
a.prototype._applyAddEdits=function(a,b){for(var c=a.addResults,e=this._queryEngine,g=e.geometryType,h=e.hasM,k=e.hasZ,l=e.objectIdField,m=e.spatialReference,e=e.featureStore,n=[],p=0;p<b.length;p++){var q=b[p];if(q.geometry&&g!==u.getJsonType(q.geometry))c.push(A.createFeatureEditErrorResult("Incorrect geometry type."));else{var t=this._createDefaultAttributes(),r=A.mixAttributes(this._fieldsIndex,this._requiredFields,t,q.attributes);r?c.push(r):(this._assignObjectId(t,q.attributes),q.attributes=
t,null!=q.uid&&(a.uidToObjectId[q.uid]=q.attributes[l]),q.geometry&&(q.geometry=F.project(A.simplify(q.geometry,m),q.geometry.spatialReference,m)),n.push(q),c.push(A.createFeatureEditSuccessResult(q.attributes[l])))}}e.addMany(E.convertFromFeatures([],n,g,k,h,l))};a.prototype._applyUpdateEdits=function(a,b){a=a.updateResults;for(var c=this._queryEngine,e=c.geometryType,g=c.hasM,h=c.hasZ,k=c.objectIdField,l=c.spatialReference,c=c.featureStore,m=0;m<b.length;m++){var n=b[m],p=n.attributes,q=n.geometry,
n=p&&p[k];if(null==n)a.push(A.createFeatureEditErrorResult("Identifier field "+k+" missing"));else if(c.has(n)){var t=E.convertToFeature(c.getFeature(n),e,h,g);if(q){if(e!==u.getJsonType(q)){a.push(A.createFeatureEditErrorResult("Incorrect geometry type."));continue}t.geometry=F.project(A.simplify(q,l),q.spatialReference,l)}if(p&&(p=A.mixAttributes(this._fieldsIndex,this._requiredFields,t.attributes,p))){a.push(p);continue}c.add(E.convertFromFeature(t,e,h,g,k));a.push(A.createFeatureEditSuccessResult(n))}else a.push(A.createFeatureEditErrorResult("Feature with object id "+
n+" missing"))}};a.prototype._assignObjectId=function(a,b,c){void 0===c&&(c=!1);var e=this._queryEngine.objectIdField;c?b&&isFinite(b[e])?a[e]=b[e]:a[e]=this._featuresInfo.nextObjectId++:a[e]=this._featuresInfo.nextObjectId++};a.prototype._checkProjection=function(a){return b(this,void 0,void 0,function(){return v(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,F.checkProjectionSupport(y.WGS84,a)];case 1:return b.sent(),[3,3];case 2:throw b.sent(),new k("geojson-layer","Projection not supported");
case 3:return[2]}})})};return a}();a.default=C});